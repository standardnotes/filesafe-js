module.exports=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){(function(t){var r,r;!function(t){e.exports=t()}(function(){return function(){function e(t,n,i){function a(s,u){if(!n[s]){if(!t[s]){var c="function"==typeof r&&r;if(!u&&c)return r(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){return a(t[s][1][e]||e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}return e}()({1:[function(e,r,n){(function(e){function t(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?r(e):t}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return l(e)||c(e,t)||u()}function u(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}function l(e){if(Array.isArray(e))return e}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){function a(e){h(s,n,i,a,o,"next",e)}function o(e){h(s,n,i,a,o,"throw",e)}var s=e.apply(t,r);a(void 0)})}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),e}var g=g||function(e,t){var r={},n=r.lib={},i=function(){},a=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new o.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new o.init(r,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new o.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=n.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(){var e=g,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp(),e=[];for(var i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;4>o&&i+.75*o<r;o++)e.push(n.charAt(a>>>6*(3-o)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var r=e.length,n=this._map,i=n.charAt(64);i&&-1!=(i=e.indexOf(i))&&(r=i);for(var i=[],a=0,o=0;o<r;o++)if(o%4){var s=n.indexOf(e.charAt(o-1))<<o%4*2,u=n.indexOf(e.charAt(o))>>>6-o%4*2;i[a>>>2]|=(s|u)<<24-a%4*8,a++}return t.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,r,n,i,a,o){return((e=e+(t&r|~t&n)+i+o)<<a|e>>>32-a)+t}function r(e,t,r,n,i,a,o){return((e=e+(t&n|r&~n)+i+o)<<a|e>>>32-a)+t}function n(e,t,r,n,i,a,o){return((e=e+(t^r^n)+i+o)<<a|e>>>32-a)+t}function i(e,t,r,n,i,a,o){return((e=e+(r^(t|~n))+i+o)<<a|e>>>32-a)+t}for(var a=g,o=a.lib,s=o.WordArray,u=o.Hasher,o=a.algo,c=[],l=0;64>l;l++)c[l]=4294967296*e.abs(e.sin(l+1))|0;o=o.MD5=u.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var o=0;16>o;o++){var s=a+o,u=e[s];e[s]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var o=this._hash.words,s=e[a+0],u=e[a+1],l=e[a+2],f=e[a+3],h=e[a+4],p=e[a+5],d=e[a+6],y=e[a+7],v=e[a+8],g=e[a+9],m=e[a+10],k=e[a+11],b=e[a+12],w=e[a+13],x=e[a+14],S=e[a+15],_=o[0],I=o[1],R=o[2],D=o[3],_=t(_,I,R,D,s,7,c[0]),D=t(D,_,I,R,u,12,c[1]),R=t(R,D,_,I,l,17,c[2]),I=t(I,R,D,_,f,22,c[3]),_=t(_,I,R,D,h,7,c[4]),D=t(D,_,I,R,p,12,c[5]),R=t(R,D,_,I,d,17,c[6]),I=t(I,R,D,_,y,22,c[7]),_=t(_,I,R,D,v,7,c[8]),D=t(D,_,I,R,g,12,c[9]),R=t(R,D,_,I,m,17,c[10]),I=t(I,R,D,_,k,22,c[11]),_=t(_,I,R,D,b,7,c[12]),D=t(D,_,I,R,w,12,c[13]),R=t(R,D,_,I,x,17,c[14]),I=t(I,R,D,_,S,22,c[15]),_=r(_,I,R,D,u,5,c[16]),D=r(D,_,I,R,d,9,c[17]),R=r(R,D,_,I,k,14,c[18]),I=r(I,R,D,_,s,20,c[19]),_=r(_,I,R,D,p,5,c[20]),D=r(D,_,I,R,m,9,c[21]),R=r(R,D,_,I,S,14,c[22]),I=r(I,R,D,_,h,20,c[23]),_=r(_,I,R,D,g,5,c[24]),D=r(D,_,I,R,x,9,c[25]),R=r(R,D,_,I,f,14,c[26]),I=r(I,R,D,_,v,20,c[27]),_=r(_,I,R,D,w,5,c[28]),D=r(D,_,I,R,l,9,c[29]),R=r(R,D,_,I,y,14,c[30]),I=r(I,R,D,_,b,20,c[31]),_=n(_,I,R,D,p,4,c[32]),D=n(D,_,I,R,v,11,c[33]),R=n(R,D,_,I,k,16,c[34]),I=n(I,R,D,_,x,23,c[35]),_=n(_,I,R,D,u,4,c[36]),D=n(D,_,I,R,h,11,c[37]),R=n(R,D,_,I,y,16,c[38]),I=n(I,R,D,_,m,23,c[39]),_=n(_,I,R,D,w,4,c[40]),D=n(D,_,I,R,s,11,c[41]),R=n(R,D,_,I,f,16,c[42]),I=n(I,R,D,_,d,23,c[43]),_=n(_,I,R,D,g,4,c[44]),D=n(D,_,I,R,b,11,c[45]),R=n(R,D,_,I,S,16,c[46]),I=n(I,R,D,_,l,23,c[47]),_=i(_,I,R,D,s,6,c[48]),D=i(D,_,I,R,y,10,c[49]),R=i(R,D,_,I,x,15,c[50]),I=i(I,R,D,_,p,21,c[51]),_=i(_,I,R,D,b,6,c[52]),D=i(D,_,I,R,f,10,c[53]),R=i(R,D,_,I,m,15,c[54]),I=i(I,R,D,_,u,21,c[55]),_=i(_,I,R,D,v,6,c[56]),D=i(D,_,I,R,S,10,c[57]),R=i(R,D,_,I,d,15,c[58]),I=i(I,R,D,_,w,21,c[59]),_=i(_,I,R,D,h,6,c[60]),D=i(D,_,I,R,k,10,c[61]),R=i(R,D,_,I,l,15,c[62]),I=i(I,R,D,_,g,21,c[63]);o[0]=o[0]+_|0,o[1]=o[1]+I|0,o[2]=o[2]+R|0,o[3]=o[3]+D|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var a=e.floor(n/4294967296);for(r[15+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),r[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),t=this._hash,r=t.words,n=0;4>n;n++)i=r[n],r[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=u._createHelper(o),a.HmacMD5=u._createHmacHelper(o)}(Math),function(){var e=g,t=e.lib,r=t.Base,n=t.WordArray,t=e.algo,i=t.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,i=r.hasher.create(),a=n.create(),o=a.words,s=r.keySize,r=r.iterations;o.length<s;){u&&i.update(u);var u=i.update(e).finalize(t);i.reset();for(var c=1;c<r;c++)u=i.finalize(u),i.reset();a.concat(u)}return a.sigBytes=4*s,a}});e.EvpKDF=function(e,t,r){return i.create(r).compute(e,t)}}(),g.lib.Cipher||function(e){var t=g,r=t.lib,n=r.Base,i=r.WordArray,a=r.BufferedBlockAlgorithm,o=t.enc.Base64,s=t.algo.EvpKDF,u=r.Cipher=a.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,n){return("string"==typeof r?d:p).encrypt(e,t,r,n)},decrypt:function(t,r,n){return("string"==typeof r?d:p).decrypt(e,t,r,n)}}}});r.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=t.mode={},l=function(e,t,r){var n=this._iv;n?this._iv=void 0:n=this._prevBlock;for(var i=0;i<r;i++)e[t+i]^=n[i]},f=(r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();f.Encryptor=f.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;l.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),f.Decryptor=f.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=e.slice(t,t+n);r.decryptBlock(e,t),l.call(this,e,t,n),this._prevBlock=i}}),c=c.CBC=f,f=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,r=r-e.sigBytes%r,n=r<<24|r<<16|r<<8|r,a=[],o=0;o<r;o+=4)a.push(n);r=i.create(a,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},r.BlockCipher=u.extend({cfg:u.cfg.extend({mode:c,padding:f}),reset:function(){u.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=e.createEncryptor;else r=e.createDecryptor,this._minBufferSize=1;this._mode=r.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){e=o.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var r=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:r})}},p=r.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n);return t=i.finalize(t),i=i.cfg,h.create({ciphertext:t,key:r,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){return n||(n=i.random(8)),e=s.create({keySize:t+r}).compute(e,n),r=i.create(e.words.slice(t),4*r),e.sigBytes=4*t,h.create({key:e,iv:r,salt:n})}},d=r.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:t}),encrypt:function(e,t,r,n){return n=this.cfg.extend(n),r=n.kdf.execute(r,e.keySize,e.ivSize),n.iv=r.iv,e=p.encrypt.call(this,e,t,r.key,n),e.mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt),n.iv=r.iv,p.decrypt.call(this,e,t,r.key,n)}})}(),function(){for(var e=g,t=e.lib.BlockCipher,r=e.algo,n=[],i=[],a=[],o=[],s=[],u=[],c=[],l=[],f=[],h=[],p=[],d=0;256>d;d++)p[d]=128>d?d<<1:d<<1^283;for(var y=0,v=0,d=0;256>d;d++){var m=v^v<<1^v<<2^v<<3^v<<4,m=m>>>8^255&m^99;n[y]=m,i[m]=y;var k=p[y],b=p[k],w=p[b],x=257*p[m]^16843008*m;a[y]=x<<24|x>>>8,o[y]=x<<16|x>>>16,s[y]=x<<8|x>>>24,u[y]=x,x=16843009*w^65537*b^257*k^16843008*y,c[m]=x<<24|x>>>8,l[m]=x<<16|x>>>16,f[m]=x<<8|x>>>24,h[m]=x,y?(y=k^p[p[p[w^k]]],v^=p[p[v]]):y=v=1}var S=[0,1,2,4,8,16,32,64,128,27,54],r=r.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes/4,e=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],a=0;a<e;a++)if(a<r)i[a]=t[a];else{var o=i[a-1];a%r?6<r&&4==a%r&&(o=n[o>>>24]<<24|n[o>>>16&255]<<16|n[o>>>8&255]<<8|n[255&o]):(o=o<<8|o>>>24,o=n[o>>>24]<<24|n[o>>>16&255]<<16|n[o>>>8&255]<<8|n[255&o],o^=S[a/r|0]<<24),i[a]=i[a-r]^o}for(t=this._invKeySchedule=[],r=0;r<e;r++)a=e-r,o=r%4?i[a]:i[a-4],t[r]=4>r||4>=a?o:c[n[o>>>24]]^l[n[o>>>16&255]]^f[n[o>>>8&255]]^h[n[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,o,s,u,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,c,l,f,h,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,a,o,s){for(var u=this._nRounds,c=e[t]^r[0],l=e[t+1]^r[1],f=e[t+2]^r[2],h=e[t+3]^r[3],p=4,d=1;d<u;d++)var y=n[c>>>24]^i[l>>>16&255]^a[f>>>8&255]^o[255&h]^r[p++],v=n[l>>>24]^i[f>>>16&255]^a[h>>>8&255]^o[255&c]^r[p++],g=n[f>>>24]^i[h>>>16&255]^a[c>>>8&255]^o[255&l]^r[p++],h=n[h>>>24]^i[c>>>16&255]^a[l>>>8&255]^o[255&f]^r[p++],c=y,l=v,f=g;y=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^r[p++],v=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^r[p++],g=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^r[p++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^r[p++],e[t]=y,e[t+1]=v,e[t+2]=g,e[t+3]=h},keySize:8});e.AES=t._createHelper(r)}();var g=g||function(e,t){var r={},n=r.lib={},i=function(){},a=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new o.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new o.init(r,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new o.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=n.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(e){for(var t=g,r=t.lib,n=r.WordArray,i=r.Hasher,r=t.algo,a=[],o=[],s=function(e){return 4294967296*(e-(0|e))|0},u=2,c=0;64>c;){var l;e:{l=u;for(var f=e.sqrt(l),h=2;h<=f;h++)if(!(l%h)){l=!1;break e}l=!0}l&&(8>c&&(a[c]=s(e.pow(u,.5))),o[c]=s(e.pow(u,1/3)),c++),u++}var p=[],r=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],s=r[3],u=r[4],c=r[5],l=r[6],f=r[7],h=0;64>h;h++){if(16>h)p[h]=0|e[t+h];else{var d=p[h-15],y=p[h-2];p[h]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+p[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+p[h-16]}d=f+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&l)+o[h]+p[h],y=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&i^n&a^i&a),f=l,l=c,c=u,u=s+d|0,s=a,a=i,i=n,n=d+y|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0,r[5]=r[5]+c|0,r[6]=r[6]+l|0,r[7]=r[7]+f|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(r),t.HmacSHA256=i._createHmacHelper(r)}(Math),function(){var e=g,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,r){e=this._hasher=new e.init,"string"==typeof r&&(r=t.parse(r));var n=e.blockSize,i=4*n;r.sigBytes>i&&(r=e.finalize(r)),r.clamp();for(var a=this._oKey=r.clone(),o=this._iKey=r.clone(),s=a.words,u=o.words,c=0;c<n;c++)s[c]^=1549556828,u[c]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}();var g=g||function(e,t){var r={},n=r.lib={},i=function(){},a=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new o.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new o.init(r,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new o.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=n.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(e){var t=g,r=t.lib,n=r.Base,i=r.WordArray,t=t.x64={};t.Word=n.extend({init:function(e,t){this.high=e,this.low=t}}),t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var a=e[n];r.push(a.high),r.push(a.low)}return i.create(r,this.sigBytes)},clone:function(){for(var e=n.clone.call(this),t=e.words=this.words.slice(0),r=t.length,i=0;i<r;i++)t[i]=t[i].clone();return e}})}(),function(){function e(){return i.create.apply(i,arguments)}for(var t=g,r=t.lib.Hasher,n=t.x64,i=n.Word,a=n.WordArray,n=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],s=[],u=0;80>u;u++)s[u]=e();n=n.SHA512=r.extend({_doReset:function(){this._hash=new a.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],u=r[3],c=r[4],l=r[5],f=r[6],r=r[7],h=n.high,p=n.low,d=i.high,y=i.low,v=a.high,g=a.low,m=u.high,k=u.low,b=c.high,w=c.low,x=l.high,S=l.low,_=f.high,I=f.low,R=r.high,D=r.low,A=h,C=p,M=d,F=y,O=v,B=g,P=m,E=k,T=b,j=w,L=x,H=S,U=_,N=I,z=R,K=D,W=0;80>W;W++){var J=s[W];if(16>W)var q=J.high=0|e[t+2*W],V=J.low=0|e[t+2*W+1];else{var q=s[W-15],V=q.high,$=q.low,q=(V>>>1|$<<31)^(V>>>8|$<<24)^V>>>7,$=($>>>1|V<<31)^($>>>8|V<<24)^($>>>7|V<<25),G=s[W-2],V=G.high,X=G.low,G=(V>>>19|X<<13)^(V<<3|X>>>29)^V>>>6,X=(X>>>19|V<<13)^(X<<3|V>>>29)^(X>>>6|V<<26),V=s[W-7],Y=V.high,Q=s[W-16],Z=Q.high,Q=Q.low,V=$+V.low,q=q+Y+(V>>>0<$>>>0?1:0),V=V+X,q=q+G+(V>>>0<X>>>0?1:0),V=V+Q,q=q+Z+(V>>>0<Q>>>0?1:0);J.high=q,J.low=V}var Y=T&L^~T&U,Q=j&H^~j&N,J=A&M^A&O^M&O,ee=C&F^C&B^F&B,$=(A>>>28|C<<4)^(A<<30|C>>>2)^(A<<25|C>>>7),G=(C>>>28|A<<4)^(C<<30|A>>>2)^(C<<25|A>>>7),X=o[W],te=X.high,re=X.low,X=K+((j>>>14|T<<18)^(j>>>18|T<<14)^(j<<23|T>>>9)),Z=z+((T>>>14|j<<18)^(T>>>18|j<<14)^(T<<23|j>>>9))+(X>>>0<K>>>0?1:0),X=X+Q,Z=Z+Y+(X>>>0<Q>>>0?1:0),X=X+re,Z=Z+te+(X>>>0<re>>>0?1:0),X=X+V,Z=Z+q+(X>>>0<V>>>0?1:0),V=G+ee,J=$+J+(V>>>0<G>>>0?1:0),z=U,K=N,U=L,N=H,L=T,H=j,j=E+X|0,T=P+Z+(j>>>0<E>>>0?1:0)|0,P=O,E=B,O=M,B=F,M=A,F=C,C=X+V|0,A=Z+J+(C>>>0<X>>>0?1:0)|0}p=n.low=p+C,n.high=h+A+(p>>>0<C>>>0?1:0),y=i.low=y+F,i.high=d+M+(y>>>0<F>>>0?1:0),g=a.low=g+B,a.high=v+O+(g>>>0<B>>>0?1:0),k=u.low=k+E,u.high=m+P+(k>>>0<E>>>0?1:0),w=c.low=w+j,c.high=b+T+(w>>>0<j>>>0?1:0),S=l.low=S+H,l.high=x+L+(S>>>0<H>>>0?1:0),I=f.low=I+N,f.high=_+U+(I>>>0<N>>>0?1:0),D=r.low=D+K,r.high=R+z+(D>>>0<K>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=r._createHelper(n),t.HmacSHA512=r._createHmacHelper(n)}(),function(){var e=g,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,r){e=this._hasher=new e.init,"string"==typeof r&&(r=t.parse(r));var n=e.blockSize,i=4*n;r.sigBytes>i&&(r=e.finalize(r)),r.clamp();for(var a=this._oKey=r.clone(),o=this._iKey=r.clone(),s=a.words,u=o.words,c=0;c<n;c++)s[c]^=1549556828,u[c]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}();var g=g||function(e,t){var r={},n=r.lib={},i=function(){},a=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new o.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new o.init(r,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new o.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=n.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(){var e=g,t=e.lib,r=t.WordArray,n=t.Hasher,i=[],t=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=0;80>c;c++){if(16>c)i[c]=0|e[t+c];else{var l=i[c-3]^i[c-8]^i[c-14]^i[c-16];i[c]=l<<1|l>>>31}l=(n<<5|n>>>27)+u+i[c],l=20>c?l+(1518500249+(a&o|~a&s)):40>c?l+(1859775393+(a^o^s)):60>c?l+((a&o|a&s|o&s)-1894007588):l+((a^o^s)-899497514),u=s,s=o,o=a<<30|a>>>2,a=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+a|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(t),e.HmacSHA1=n._createHmacHelper(t)}(),function(){var e=g,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,r){e=this._hasher=new e.init,"string"==typeof r&&(r=t.parse(r));var n=e.blockSize,i=4*n;r.sigBytes>i&&(r=e.finalize(r)),r.clamp();for(var a=this._oKey=r.clone(),o=this._iKey=r.clone(),s=a.words,u=o.words,c=0;c<n;c++)s[c]^=1549556828,u[c]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=g,t=e.lib,r=t.Base,n=t.WordArray,t=e.algo,i=t.HMAC,a=t.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:t.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,a=i.create(r.hasher,e),o=n.create(),s=n.create([1]),u=o.words,c=s.words,l=r.keySize,r=r.iterations;u.length<l;){var f=a.update(t).finalize(s);a.reset();for(var h=f.words,p=h.length,d=f,y=1;y<r;y++){d=a.finalize(d),a.reset();for(var v=d.words,g=0;g<p;g++)h[g]^=v[g]}o.concat(f),c[0]++}return o.sigBytes=4*l,o}});e.PBKDF2=function(e,t,r){return a.create(r).compute(e,t)}}();var g=g||function(e,t){var r={},n=r.lib={},i=function(){},a=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new o.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new o.init(r,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new o.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=n.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(){var e=g,t=e.lib,r=t.WordArray,n=t.Hasher,i=[],t=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=0;80>c;c++){if(16>c)i[c]=0|e[t+c];else{var l=i[c-3]^i[c-8]^i[c-14]^i[c-16];i[c]=l<<1|l>>>31}l=(n<<5|n>>>27)+u+i[c],l=20>c?l+(1518500249+(a&o|~a&s)):40>c?l+(1859775393+(a^o^s)):60>c?l+((a&o|a&s|o&s)-1894007588):l+((a^o^s)-899497514),u=s,s=o,o=a<<30|a>>>2,a=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+a|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(t),e.HmacSHA1=n._createHmacHelper(t)}(),Object.defineProperty(n,"__esModule",{value:!0}),n.StandardFile=n.SFItemTransformer=n.SFCryptoWeb=n.SFCryptoJS=n.SFAbstractCrypto=n.SFItemHistoryEntry=n.SFItemHistory=n.SFHistorySession=n.SFPrivileges=n.SFPredicate=n.SFItemParams=n.SFItem=n.SFSyncManager=n.SFStorageManager=n.SFSingletonManager=n.SFSessionHistoryManager=n.SFPrivilegesManager=n.SFModelManager=n.SFMigrationManager=n.SFHttpManager=n.SFAuthManager=n.SFAlertManager=void 0;var m=function(){function e(){d(this,e)}return v(e,[{key:"alert",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){window.alert(t.text),e()}));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"confirm",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){window.confirm(t.text)?e():r()}));case 1:case"end":return e.stop()}},e)}));return e}()}]),e}();n.SFAlertManager=m;var k=function(){function e(t,r,n,i){d(this,e),e.DidSignOutEvent="DidSignOutEvent",e.WillSignInEvent="WillSignInEvent",e.DidSignInEvent="DidSignInEvent",this.httpManager=r,this.storageManager=t,this.alertManager=n||new m,this.$timeout=i||setTimeout.bind(window),this.eventHandlers=[]}return v(e,[{key:"addEventHandler",value:function(e){return this.eventHandlers.push(e),e}},{key:"removeEventHandler",value:function(e){_.pull(this.eventHandlers,e)}},{key:"notifyEvent",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=this.eventHandlers[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){(0,a.value)(e,t||{})}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"saveKeys",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._keys=t,e.next=3,this.storageManager.setItem("mk",t.mk);case 3:return e.next=5,this.storageManager.setItem("ak",t.ak);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"signout",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._keys=null,this._authParams=null,!r){t.next=6;break}return t.abrupt("return",this.storageManager.clearAllData().then(function(){n.notifyEvent(e.DidSignOutEvent)}));case 6:this.notifyEvent(e.DidSignOutEvent);case 7:case"end":return t.stop()}},t,this)}));return t}()},{key:"keys",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._keys){e.next=11;break}return e.next=3,this.storageManager.getItem("mk");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.t0=t,e.next=9,this.storageManager.getItem("ak");case 9:e.t1=e.sent,this._keys={mk:e.t0,ak:e.t1};case 11:return e.abrupt("return",this._keys);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"getAuthParams",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._authParams){e.next=5;break}return e.next=3,this.storageManager.getItem("auth_params");case 3:t=e.sent,this._authParams=JSON.parse(t);case 5:if(!this._authParams||this._authParams.version){e.next=9;break}return e.next=8,this.defaultProtocolVersion();case 8:this._authParams.version=e.sent;case 9:return e.abrupt("return",this._authParams);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"defaultProtocolVersion",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keys();case 2:if(!(t=e.sent)||!t.ak){e.next=7;break}return e.abrupt("return","002");case 7:return e.abrupt("return","001");case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"protocolVersion",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthParams();case 2:if(!(t=e.sent)||!t.version){e.next=5;break}return e.abrupt("return",t.version);case 5:return e.abrupt("return",this.defaultProtocolVersion());case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"getAuthParamsForEmail",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){var i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=_.merge({email:r},n),i.api=w.getApiVersion(),e.abrupt("return",new Promise(function(e,r){var n=t+"/auth/params";a.httpManager.getAbsolute(n,i,function(t){e(t)},function(t){console.error("Error getting auth params",t),"object"!==f(t)&&(t={error:{message:"A server error occurred while trying to sign in. Please try again."}}),e(t)})}));case 3:case"end":return e.stop()}},e)}));return e}()},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"isLocked",value:function(){return 1==this.locked}},{key:"unlockAndResolve",value:function(e,t){this.unlock(),e(t)}},{key:"login",value:function(){function t(e,t,n,i,a){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r,n,i,a,o){var s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=p(regeneratorRuntime.mark(function t(u,c){var l,h,d,y,v,g,m,k,b,x,S,I,R;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.keys();case 2:if(null==(l=t.sent)){t.next=6;break}return u({error:{message:"Cannot log in because already signed in."}}),t.abrupt("return");case 6:if(!s.isLocked()){t.next=9;break}return u({error:{message:"Login already in progress."}}),t.abrupt("return");case 9:return s.lock(),s.notifyEvent(e.WillSignInEvent),t.next=13,s.getAuthParamsForEmail(r,n,o);case 13:if(h=t.sent,h.identifier=n,!h.error){t.next=18;break}return s.unlockAndResolve(u,h),t.abrupt("return");case 18:if(h&&h.pw_cost){t.next=21;break}return s.unlockAndResolve(u,{error:{message:"Invalid email or password."}}),t.abrupt("return");case 21:if(SFJS.supportedVersions().includes(h.version)){t.next=25;break}return d=SFJS.isVersionNewerThanLibraryVersion(h.version)?"This version of the application does not support your newer account type. Please upgrade to the latest version of Standard Notes to sign in.":"The protocol version associated with your account is outdated and no longer supported by this application. Please visit standardnotes.org/help/security for more information.",s.unlockAndResolve(u,{error:{message:d}}),t.abrupt("return");case 25:if(!SFJS.isProtocolVersionOutdated(h.version)){t.next=32;break}return y="The encryption version for your account, ".concat(h.version,", is outdated and requires upgrade. You may proceed with login, but are advised to perform a security update using the web or desktop application. Please visit standardnotes.org/help/security for more information."),v=!1,t.next=30,s.alertManager.confirm({title:"Update Needed",text:y,confirmButtonText:"Sign In"}).catch(function(){s.unlockAndResolve(u,{error:{}}),v=!0});case 30:if(!v){t.next=32;break}return t.abrupt("return");case 32:if(SFJS.supportsPasswordDerivationCost(h.pw_cost)){t.next=36;break}return g="Your account was created on a platform with higher security capabilities than this browser supports. If we attempted to generate your login keys here, it would take hours. Please use a browser with more up to date security capabilities, like Google Chrome or Firefox, to log in.",s.unlockAndResolve(u,{error:{message:g}}),t.abrupt("return");case 36:if(m=SFJS.costMinimumForVersion(h.version),!(h.pw_cost<m)){t.next=41;break}return k="Unable to login due to insecure password parameters. Please visit standardnotes.org/help/security for more information.",s.unlockAndResolve(u,{error:{message:k}}),t.abrupt("return");case 41:if(!a){t.next=47;break}if(b=SFJS.version(),h.version===b){t.next=47;break}return x="Strict sign in refused server sign in parameters. The latest security version is ".concat(b,", but your account is reported to have version ").concat(h.version,". If you'd like to proceed with sign in anyway, please disable strict sign in and try again."),s.unlockAndResolve(u,{error:{message:x}}),t.abrupt("return");case 47:return t.next=49,SFJS.crypto.computeEncryptionKeysForUser(i,h);case 49:S=t.sent,I=r+"/auth/sign_in",R=_.merge({password:S.pw,email:n},o),R.api=w.getApiVersion(),s.httpManager.postAbsolute(I,R,function(){var t=p(regeneratorRuntime.mark(function t(i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.handleAuthResponse(i,n,r,h,S);case 2:s.notifyEvent(e.DidSignInEvent),s.$timeout(function(){return s.unlockAndResolve(u,i)});case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.error("Error logging in",e),"object"!==f(e)&&(e={error:{message:"A server error occurred while trying to sign in. Please try again."}}),s.$timeout(function(){return s.unlockAndResolve(u,e)})});case 54:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}},t)}));return t}()},{key:"register",value:function(e,t,r){var n=this;return new Promise(function(){var i=p(regeneratorRuntime.mark(function i(a,o){var s,u,c,l,h,d,y;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!n.isLocked()){i.next=3;break}return a({error:{message:"Register already in progress."}}),i.abrupt("return");case 3:if(s=8,!(r.length<s)){i.next=8;break}return u="Your password must be at least ".concat(s," characters in length. For your security, please choose a longer password or, ideally, a passphrase, and try again."),a({error:{message:u}}),i.abrupt("return");case 8:return n.lock(),i.next=11,SFJS.crypto.generateInitialKeysAndAuthParamsForUser(t,r);case 11:c=i.sent,l=c.keys,h=c.authParams,d=e+"/auth",y=_.merge({password:l.pw,email:t},h),y.api=w.getApiVersion(),n.httpManager.postAbsolute(d,y,function(){var r=p(regeneratorRuntime.mark(function r(i){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.handleAuthResponse(i,t,e,h,l);case 2:n.unlockAndResolve(a,i);case 3:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}(),function(e){console.error("Registration error",e),"object"!==f(e)&&(e={error:{message:"A server error occurred while trying to register. Please try again."}}),n.unlockAndResolve(a,e)});case 18:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"changePassword",value:function(){function e(e,r,n,i,a){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i,a){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=p(regeneratorRuntime.mark(function e(s,u){var c,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.isLocked()){e.next=3;break}return s({error:{message:"Change password already in progress."}}),e.abrupt("return");case 3:o.lock(),c=i.pw,l=t+"/auth/change_pw",h=_.merge({new_password:c,current_password:n},a),h.api=w.getApiVersion(),o.httpManager.postAuthenticatedAbsolute(l,h,function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.handleAuthResponse(t,r,null,a,i);case 2:o.unlockAndResolve(s,t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),function(e){"object"!==f(e)&&(e={error:{message:"Something went wrong while changing your password. Your password was not changed. Please try again."}}),o.unlockAndResolve(s,e)});case 9:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"handleAuthResponse",value:function(){function e(e,r,n,i,a){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i,a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return e.next=3,this.storageManager.setItem("server",n);case 3:return this._authParams=i,e.next=6,this.storageManager.setItem("auth_params",JSON.stringify(i));case 6:return e.next=8,this.storageManager.setItem("jwt",t.token);case 8:return e.abrupt("return",this.saveKeys(a));case 9:case"end":return e.stop()}},e,this)}));return e}()}]),e}();n.SFAuthManager=k;var b="undefined"!=typeof window?window:void 0!==e?e:null,w=function(){function e(t,r){d(this,e),this.$timeout=t||setTimeout.bind(b)}return v(e,null,[{key:"getApiVersion",value:function(){return"20190520"}}]),v(e,[{key:"setJWTRequestHandler",value:function(e){this.jwtRequestHandler=e}},{key:"setAuthHeadersForRequest",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.jwtRequestHandler();case 2:r=e.sent,r&&t.setRequestHeader("Authorization","Bearer "+r);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"postAbsolute",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("post",t,r,n,i));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"postAuthenticatedAbsolute",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("post",t,r,n,i,!0));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"patchAbsolute",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("patch",t,r,n,i));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"getAbsolute",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("get",t,r,n,i));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"httpRequest",value:function(){function e(e,r,n,i,a){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i,a){var o,s=this,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>5&&void 0!==u[5]&&u[5],e.abrupt("return",new Promise(function(){var e=p(regeneratorRuntime.mark(function e(u,c){var l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=new XMLHttpRequest,l.onreadystatechange=function(){if(4==l.readyState){var e=l.responseText;if(e)try{e=JSON.parse(e)}catch(e){}l.status>=200&&l.status<=299?s.$timeout(function(){i(e),u(e)}):(console.error("Request error:",e),s.$timeout(function(){a(e,l.status),c(e)}))}},"get"==t&&Object.keys(n).length>0&&(r=s.urlForUrlAndParams(r,n)),l.open(t,r,!0),l.setRequestHeader("Content-type","application/json"),!o){e.next=8;break}return e.next=8,s.setAuthHeadersForRequest(l);case 8:"post"==t||"patch"==t?l.send(JSON.stringify(n)):l.send();case 9:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return e}()},{key:"urlForUrlAndParams",value:function(e,t){var r=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&");return e.includes("?")?e+"&"+r:e+"?"+r}}]),e}();n.SFHttpManager=w;var x=function(){function e(t,r,n,i){var a=this;d(this,e),this.modelManager=t,this.syncManager=r,this.storageManager=n,this.completionHandlers=[],this.loadMigrations();var o=!1,s=i.addEventHandler(function(e){e==k.DidSignInEvent&&(o=!0)});this.receivedLocalDataEvent=r.initialDataLoaded(),this.syncManager.addEventHandler(function(){var e=p(regeneratorRuntime.mark(function e(t,r){var n,u,c,l,f,h,p,d,y,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n="local-data-loaded"==t,u="sync:completed"==t,!n&&!u){e.next=40;break}if(n?a.receivedLocalDataEvent=!0:u&&(a.receivedSyncCompletedEvent=!0),!a.receivedLocalDataEvent||!a.receivedSyncCompletedEvent){e.next=40;break}if(!o){e.next=39;break}return o=!1,i.removeEventHandler(s),e.next=10,a.getCompletedMigrations();case 10:c=e.sent.slice(),l=!0,f=!1,h=void 0,e.prev=14,p=c[Symbol.iterator]();case 16:if(l=(d=p.next()).done){e.next=25;break}return y=d.value,e.next=20,a.migrationForEncodedName(y);case 20:v=e.sent,v.runOnlyOnce||_.pull(a._completed,y);case 22:l=!0,e.next=16;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(14),f=!0,h=e.t0;case 31:e.prev=31,e.prev=32,l||null==p.return||p.return();case 34:if(e.prev=34,!f){e.next=37;break}throw h;case 37:return e.finish(34);case 38:return e.finish(31);case 39:a.runPendingMigrations();case 40:case"end":return e.stop()}},e,null,[[14,27,31,39],[32,,34,38]])}));return function(t,r){return e.apply(this,arguments)}}())}return v(e,[{key:"addCompletionHandler",value:function(e){this.completionHandlers.push(e)}},{key:"removeCompletionHandler",value:function(e){_.pull(this.completionHandlers,e)}},{key:"migrationForEncodedName",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decode(t);case 2:return r=e.sent,e.abrupt("return",this.migrations.find(function(e){return e.name==r}));case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"loadMigrations",value:function(){this.migrations=this.registeredMigrations()}},{key:"registeredMigrations",value:function(){}},{key:"runPendingMigrations",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i,a,o,s,u,c,l,f,h,p,d,y,v,g,m,k,b,w,x,S,_,I,R,D,A,C;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPendingMigrations();case 2:for(t=e.sent,r=!0,n=!1,i=void 0,e.prev=6,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0)s=o.value,s.items=[];e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),n=!0,i=e.t0;case 14:e.prev=14,e.prev=15,r||null==a.return||a.return();case 17:if(e.prev=17,!n){e.next=20;break}throw i;case 20:return e.finish(17);case 21:return e.finish(14);case 22:u=!0,c=!1,l=void 0,e.prev=25,f=this.modelManager.allNondummyItems[Symbol.iterator]();case 27:if(u=(h=f.next()).done){e.next=51;break}for(p=h.value,d=!0,y=!1,v=void 0,e.prev=32,g=t[Symbol.iterator]();!(d=(m=g.next()).done);d=!0)s=m.value,p.content_type==s.content_type&&s.items.push(p);e.next=40;break;case 36:e.prev=36,e.t1=e.catch(32),y=!0,v=e.t1;case 40:e.prev=40,e.prev=41,d||null==g.return||g.return();case 43:if(e.prev=43,!y){e.next=46;break}throw v;case 46:return e.finish(43);case 47:return e.finish(40);case 48:u=!0,e.next=27;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(25),c=!0,l=e.t2;case 57:e.prev=57,e.prev=58,u||null==f.return||f.return();case 60:if(e.prev=60,!c){e.next=63;break}throw l;case 63:return e.finish(60);case 64:return e.finish(57);case 65:k=!0,b=!1,w=void 0,e.prev=68,x=t[Symbol.iterator]();case 70:if(k=(S=x.next()).done){e.next=81;break}if(s=S.value,!(s.items&&s.items.length>0||s.customHandler)){e.next=77;break}return e.next=75,this.runMigration(s,s.items);case 75:e.next=78;break;case 77:this.markMigrationCompleted(s);case 78:k=!0,e.next=70;break;case 81:e.next=87;break;case 83:e.prev=83,e.t3=e.catch(68),b=!0,w=e.t3;case 87:e.prev=87,e.prev=88,k||null==x.return||x.return();case 90:if(e.prev=90,!b){e.next=93;break}throw w;case 93:return e.finish(90);case 94:return e.finish(87);case 95:for(_=!0,I=!1,R=void 0,e.prev=98,D=this.completionHandlers[Symbol.iterator]();!(_=(A=D.next()).done);_=!0)(C=A.value)();e.next=106;break;case 102:e.prev=102,e.t4=e.catch(98),I=!0,R=e.t4;case 106:e.prev=106,e.prev=107,_||null==D.return||D.return();case 109:if(e.prev=109,!I){e.next=112;break}throw R;case 112:return e.finish(109);case 113:return e.finish(106);case 114:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21],[25,53,57,65],[32,36,40,48],[41,,43,47],[58,,60,64],[68,83,87,95],[88,,90,94],[98,102,106,114],[107,,109,113]])}));return e}()},{key:"encode",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.btoa(t));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"decode",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.atob(t));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"getCompletedMigrations",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._completed){e.next=5;break}return e.next=3,this.storageManager.getItem("migrations");case 3:t=e.sent,this._completed=t?JSON.parse(t):[];case 5:return e.abrupt("return",this._completed);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"getPendingMigrations",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCompletedMigrations();case 2:t=e.sent,r=[],n=!0,i=!1,a=void 0,e.prev=7,o=this.migrations[Symbol.iterator]();case 9:if(n=(s=o.next()).done){e.next=22;break}return u=s.value,e.t0=t,e.next=14,this.encode(u.name);case 14:if(e.t1=e.sent,e.t2=e.t0.indexOf.call(e.t0,e.t1),e.t3=-1,e.t2!=e.t3){e.next=19;break}r.push(u);case 19:n=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t4=e.catch(7),i=!0,a=e.t4;case 28:e.prev=28,e.prev=29,n||null==o.return||o.return();case 31:if(e.prev=31,!i){e.next=34;break}throw a;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",r);case 37:case"end":return e.stop()}},e,this,[[7,24,28,36],[29,,31,35]])}));return e}()},{key:"markMigrationCompleted",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCompletedMigrations();case 2:return r=e.sent,e.t0=r,e.next=6,this.encode(t.name);case 6:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),this.storageManager.setItem("migrations",JSON.stringify(r)),t.running=!1;case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"runMigration",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.running){e.next=2;break}return e.abrupt("return");case 2:if(console.log("Running migration:",t.name),t.running=!0,!t.customHandler){e.next=8;break}return e.abrupt("return",t.customHandler().then(function(){n.markMigrationCompleted(t)}));case 8:return e.abrupt("return",t.handler(r).then(function(){n.markMigrationCompleted(t)}));case 9:case"end":return e.stop()}},e)}));return e}()}]),e}();n.SFMigrationManager=x;var S=function(){function e(t){d(this,e),e.MappingSourceRemoteRetrieved="MappingSourceRemoteRetrieved",e.MappingSourceRemoteSaved="MappingSourceRemoteSaved",e.MappingSourceLocalSaved="MappingSourceLocalSaved",e.MappingSourceLocalRetrieved="MappingSourceLocalRetrieved",e.MappingSourceLocalDirtied="MappingSourceLocalDirtied",e.MappingSourceComponentRetrieved="MappingSourceComponentRetrieved",e.MappingSourceDesktopInstalled="MappingSourceDesktopInstalled",e.MappingSourceRemoteActionRetrieved="MappingSourceRemoteActionRetrieved",e.MappingSourceFileImport="MappingSourceFileImport",e.isMappingSourceRetrieved=function(t){return[e.MappingSourceRemoteRetrieved,e.MappingSourceComponentRetrieved,e.MappingSourceRemoteActionRetrieved].includes(t)},this.$timeout=t||setTimeout.bind(window),this.itemSyncObservers=[],this.items=[],this.itemsHash={},this.missedReferences={},this.uuidChangeObservers=[]}return v(e,[{key:"handleSignout",value:function(){this.items.length=0,this.itemsHash={},this.missedReferences={}}},{key:"addModelUuidChangeObserver",value:function(e,t){this.uuidChangeObservers.push({id:e,callback:t})}},{key:"notifyObserversOfUuidChange",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=this.uuidChangeObservers[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;try{s.callback(e,t)}catch(e){console.error("Notify observers of uuid change exception:",e)}}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"alternateUUIDForItem",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.createItem(r),t.next=3,SFJS.crypto.generateUUID();case 3:for(n.uuid=t.sent,n.informReferencesOfUUIDChange(r.uuid,n.uuid),this.informModelsOfUUIDChangeForItem(n,r.uuid,n.uuid),i=!0,a=!1,o=void 0,t.prev=9,s=r.referencingObjects[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)c=u.value,c.setIsNoLongerBeingReferencedBy(r),r.setIsNoLongerBeingReferencedBy(c),c.addItemAsRelationship(n);t.next=17;break;case 13:t.prev=13,t.t0=t.catch(9),a=!0,o=t.t0;case 17:t.prev=17,t.prev=18,i||null==s.return||s.return();case 20:if(t.prev=20,!a){t.next=23;break}throw o;case 23:return t.finish(20);case 24:return t.finish(17);case 25:return this.setItemsDirty(r.referencingObjects,!0),this.resolveReferencesForItem(n),this.loggingEnabled&&console.log(r.uuid,"--\x3e",n.uuid),r.deleted=!0,r.content.references=[],this.setItemDirty(r,!1,!1,e.MappingSourceLocalSaved),t.next=33,this.mapResponseItemsToLocalModels([r],e.MappingSourceLocalSaved);case 33:return this.addItem(n),this.setItemDirty(n,!0,!0,e.MappingSourceLocalSaved),this.notifyObserversOfUuidChange(r,n),t.abrupt("return",n);case 37:case"end":return t.stop()}},t,this,[[9,13,17,25],[18,,20,24]])}));return t}()},{key:"informModelsOfUUIDChangeForItem",value:function(e,t,r){var n=!0,i=!1,a=void 0;try{for(var o,s=this.items[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.potentialItemOfInterestHasChangedItsUUID(e,t,r)}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"didSyncModelsOffline",value:function(t){this.notifySyncObserversOfModels(t,e.MappingSourceLocalSaved)}},{key:"mapResponseItemsToLocalModels",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mapResponseItemsToLocalModelsWithOptions({items:t,source:r,sourceKey:n}));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"mapResponseItemsToLocalModelsOmittingFields",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mapResponseItemsToLocalModelsWithOptions({items:t,omitFields:r,source:n,sourceKey:i}));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"mapResponseItemsToLocalModelsWithOptions",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n,i,a,o,u,c,l,f,h,p,d,y,v,g,m,k,b,w,x,S,_,I,R,D,A,C,M,F,O,B,P,E,T,j,L,H,U,N,z,K,W;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.items,n=t.omitFields,i=t.source,a=t.sourceKey,o=t.options,u=[],c=[],l=[],f=!0,h=!1,p=void 0,e.prev=5,d=r[Symbol.iterator]();case 7:if(f=(y=d.next()).done){e.next=58;break}if(v=y.value){e.next=11;break}return e.abrupt("continue",55);case 11:if(g=!v.content&&!v.errorDecrypting,!(m=!v.content_type||!v.uuid)&&!g||v.deleted){e.next=16;break}return console.error("Server response item is corrupt:",v),e.abrupt("continue",55);case 16:if(!Array.isArray(n)){e.next=36;break}for(k=!0,b=!1,w=void 0,e.prev=20,x=n[Symbol.iterator]();!(k=(S=x.next()).done);k=!0)_=S.value,delete v[_];e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),b=!0,w=e.t0;case 28:e.prev=28,e.prev=29,k||null==x.return||x.return();case 31:if(e.prev=31,!b){e.next=34;break}throw w;case 34:return e.finish(31);case 35:return e.finish(28);case 36:if(I=this.findItem(v.uuid),I&&(I.updateFromJSON(v),I.dummy=!1),R=v.content_type||I&&I.content_type,!(D=this.acceptableContentTypes&&!this.acceptableContentTypes.includes(R))){e.next=42;break}return e.abrupt("continue",55);case 42:if(A=!1,1!=v.deleted){e.next=50;break}if(!v.dirty){e.next=48;break}A=!0,e.next=50;break;case 48:return I&&(u.push(I),l.push(I),this.removeItemLocally(I)),e.abrupt("continue",55);case 50:I||(I=this.createItem(v)),this.addItem(I,A),I.errorDecrypting||l.push(I),u.push(I),c.push(v);case 55:f=!0,e.next=7;break;case 58:e.next=64;break;case 60:e.prev=60,e.t1=e.catch(5),h=!0,p=e.t1;case 64:e.prev=64,e.prev=65,f||null==d.return||d.return();case 67:if(e.prev=67,!h){e.next=70;break}throw p;case 70:return e.finish(67);case 71:return e.finish(64);case 72:for(C=!0,M=!1,F=void 0,e.prev=75,O=c.entries()[Symbol.iterator]();!(C=(B=O.next()).done);C=!0)P=s(B.value,2),E=P[0],T=P[1],j=u[E],T.content&&this.resolveReferencesForItem(j),j.didFinishSyncing();e.next=83;break;case 79:e.prev=79,e.t2=e.catch(75),M=!0,F=e.t2;case 83:e.prev=83,e.prev=84,C||null==O.return||O.return();case 86:if(e.prev=86,!M){e.next=89;break}throw F;case 89:return e.finish(86);case 90:return e.finish(83);case 91:for(L=this.popMissedReferenceStructsForObjects(c),H=!0,U=!1,N=void 0,e.prev=95,z=function(){var e=W.value,t=u.find(function(t){return t.uuid==e.reference_uuid});if(t){e.for_item.addItemAsRelationship(t)}},K=L[Symbol.iterator]();!(H=(W=K.next()).done);H=!0)z();e.next=104;break;case 100:e.prev=100,e.t3=e.catch(95),U=!0,N=e.t3;case 104:e.prev=104,e.prev=105,H||null==K.return||K.return();case 107:if(e.prev=107,!U){e.next=110;break}throw N;case 110:return e.finish(107);case 111:return e.finish(104);case 112:return e.next=114,this.notifySyncObserversOfModels(l,i,a);case 114:return e.abrupt("return",u);case 115:case"end":return e.stop()}},e,this,[[5,60,64,72],[20,24,28,36],[29,,31,35],[65,,67,71],[75,79,83,91],[84,,86,90],[95,100,104,112],[105,,107,111]])}));return e}()},{key:"missedReferenceBuildKey",value:function(e,t){return"".concat(e,":").concat(t)}},{key:"popMissedReferenceStructsForObjects",value:function(e){if(!e||0==e.length)return[];for(var t=[],r=[],n=e.map(function(e){return e.uuid}),i=n[0].length,a=Object.keys(this.missedReferences),o=0,s=a;o<s.length;o++){var u=s[o];n.includes(u.substring(0,i))&&(t.push(this.missedReferences[u]),r.push(u))}for(var c=0,l=r;c<l.length;c++){var f=l[c];delete this.missedReferences[f]}return t}},{key:"resolveReferencesForItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.errorDecrypting){var r=e.contentObject;if(e.updateLocalRelationships(),r.references){var n=r.references.slice(),i=n.map(function(e){return e.uuid}),a=this.findItems(i,!0),o=!0,u=!1,c=void 0;try{for(var l,f=a.entries()[Symbol.iterator]();!(o=(l=f.next()).done);o=!0){var h=s(l.value,2),p=h[0],d=h[1];if(d)e.addItemAsRelationship(d),t&&this.setItemDirty(d,!0);else{var y=i[p],v=this.missedReferenceBuildKey(y,e.uuid);if(!this.missedReferences[v]){var g={reference_uuid:y,for_item:e};this.missedReferences[v]=g}}}}catch(e){u=!0,c=e}finally{try{o||null==f.return||f.return()}finally{if(u)throw c}}}}}},{key:"notifySyncObserversOfModels",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){var i,a,o,s,u,c,l,f=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=this.itemSyncObservers.sort(function(e,t){return e.priority<t.priority?-1:1}),a=!0,o=!1,s=void 0,e.prev=4,u=regeneratorRuntime.mark(function e(){var i,a,o,s,u,c,h,p,d,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=l.value,a=i.types.includes("*")?t:t.filter(function(e){return i.types.includes(e.content_type)}),o=[],s=[],u=!0,c=!1,h=void 0,e.prev=6,p=a[Symbol.iterator]();!(u=(d=p.next()).done);u=!0)y=d.value,y.deleted?s.push(y):o.push(y);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),c=!0,h=e.t0;case 14:e.prev=14,e.prev=15,u||null==p.return||p.return();case 17:if(e.prev=17,!c){e.next=20;break}throw h;case 20:return e.finish(17);case 21:return e.finish(14);case 22:if(!(a.length>0)){e.next=25;break}return e.next=25,f._callSyncObserverCallbackWithTimeout(i,a,o,s,r,n);case 25:case"end":return e.stop()}},e,null,[[6,10,14,22],[15,,17,21]])}),c=i[Symbol.iterator]();case 7:if(a=(l=c.next()).done){e.next=12;break}return e.delegateYield(u(),"t0",9);case 9:a=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),o=!0,s=e.t1;case 18:e.prev=18,e.prev=19,a||null==c.return||c.return();case 21:if(e.prev=21,!o){e.next=24;break}throw s;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[4,14,18,26],[19,,21,25]])}));return e}()},{key:"_callSyncObserverCallbackWithTimeout",value:function(){function e(e,r,n,i,a,o){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i,a,o){var s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,u){s.$timeout(function(){try{t.callback(r,n,i,a,o)}catch(e){console.error("Sync observer exception",e)}finally{e()}})}));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"setItemDirty",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;this.setItemsDirty([e],t,r,n,i)}},{key:"setItemsDirty",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=!0,s=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){c.value.setDirty(r,n)}}catch(e){s=!0,u=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}this.notifySyncObserversOfModels(t,i||e.MappingSourceLocalDirtied,a)}},{key:"createItem",value:function(t){var r=e.ContentTypeClassMapping&&e.ContentTypeClassMapping[t.content_type];return r||(r=F),new r(t)}},{key:"createDuplicateItemFromResponseItem",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.setDirty){e.next=3;break}return console.error("Attempting to create conflicted copy of non-response item."),e.abrupt("return",null);case 3:return r=JSON.parse(JSON.stringify(t)),e.next=6,SFJS.crypto.generateUUID();case 6:return r.uuid=e.sent,n=this.createItem(r),e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"duplicateItemAndAddAsConflict",value:function(e){return this.duplicateItemWithCustomContentAndAddAsConflict({content:e.content,duplicateOf:e})}},{key:"duplicateItemWithCustomContentAndAddAsConflict",value:function(e){var t=e.content,r=e.duplicateOf,n=this.duplicateItemWithCustomContent({content:t,duplicateOf:r});return this.addDuplicatedItemAsConflict({duplicate:n,duplicateOf:r}),n}},{key:"addDuplicatedItemAsConflict",value:function(e){var t=e.duplicate,r=e.duplicateOf;this.addDuplicatedItem(t,r),t.content.conflict_of=r.uuid}},{key:"duplicateItemWithCustomContent",value:function(e){var t=e.content,r=e.duplicateOf,n=new r.constructor({content:t});return n.created_at=r.created_at,n.content_type||(n.content_type=r.content_type),n}},{key:"duplicateItemAndAdd",value:function(e){var t=this.duplicateItemWithoutAdding(e);return this.addDuplicatedItem(t,e),t}},{key:"duplicateItemWithoutAdding",value:function(e){var t=new e.constructor({content:e.content});return t.created_at=e.created_at,t.content_type||(t.content_type=e.content_type),t}},{key:"addDuplicatedItem",value:function(e,t){this.addItem(e);var r=!0,n=!1,i=void 0;try{for(var a,o=t.referencingObjects[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.addItemAsRelationship(e),this.setItemDirty(s,!0)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}this.resolveReferencesForItem(e),this.setItemDirty(e,!0)}},{key:"addItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addItems([e],t)}},{key:"addItems",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach(function(e){t.itemsHash[e.uuid]||(t.itemsHash[e.uuid]=e,t.items.push(e))})}},{key:"addItemSyncObserver",value:function(e,t,r){this.addItemSyncObserverWithPriority({id:e,types:t,callback:r,priority:1})}},{key:"addItemSyncObserverWithPriority",value:function(e){var t=e.id,r=e.priority,n=e.types,i=e.callback;Array.isArray(n)||(n=[n]),this.itemSyncObservers.push({id:t,types:n,priority:r,callback:i})}},{key:"removeItemSyncObserver",value:function(e){_.remove(this.itemSyncObservers,_.find(this.itemSyncObservers,{id:e}))}},{key:"getDirtyItems",value:function(){return this.items.filter(function(e){return 1==e.dirty&&!e.dummy&&(!e.errorDecrypting||e.deleted)})}},{key:"clearDirtyItems",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.setDirty(!1)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"removeAndDirtyAllRelationshipsForItem",value:function(e){if(!e.errorDecrypting){var t=!0,r=!1,n=void 0;try{for(var i,a=e.content.references[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=this.findItem(o.uuid);s&&(e.removeItemAsRelationship(s),s.hasRelationshipWithItem(e)&&(s.removeItemAsRelationship(e),this.setItemDirty(s,!0)))}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}var u=!0,c=!1,l=void 0;try{for(var f,h=e.referencingObjects[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;p.removeItemAsRelationship(e),this.setItemDirty(p,!0)}}catch(e){c=!0,l=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw l}}e.referencingObjects=[]}},{key:"setAllItemsDirty",value:function(){var e=this.allItems;this.setItemsDirty(e,!0)}},{key:"setItemToBeDeleted",value:function(e){e.deleted=!0,e.dummy||this.setItemDirty(e,!0),this.removeAndDirtyAllRelationshipsForItem(e)}},{key:"removeItemLocally",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:_.remove(this.items,{uuid:t.uuid}),delete this.itemsHash[t.uuid],t.isBeingRemovedLocally();case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"allItemsMatchingTypes",value:function(e){return this.allItems.filter(function(t){return(_.includes(e,t.content_type)||_.includes(e,"*"))&&!t.dummy})}},{key:"invalidItems",value:function(){return this.allItems.filter(function(e){return e.errorDecrypting})}},{key:"validItemsForContentType",value:function(e){return this.allItems.filter(function(t){return t.content_type==e&&!t.errorDecrypting})}},{key:"findItem",value:function(e){return this.itemsHash[e]}},{key:"findItems",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value,c=this.itemsHash[u];(c||t)&&r.push(c)}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}},{key:"itemsMatchingPredicate",value:function(e){return this.itemsMatchingPredicates([e])}},{key:"itemsMatchingPredicates",value:function(e){return this.filterItemsWithPredicates(this.allItems,e)}},{key:"filterItemsWithPredicates",value:function(e,t){return e.filter(function(e){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(!e.satisfiesPredicate(s))return!1}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return!0})}},{key:"importItems",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n,i,a,o,s,u,c,l,f,h,p,d,y,v,g,m,k,b,w,x,S,_,I,R,D,A,C;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=[],i={},a=!0,o=!1,s=void 0,t.prev=5,u=r[Symbol.iterator]();case 7:if(a=(c=u.next()).done){t.next=18;break}if(l=c.value,f=this.findItem(l.uuid)){t.next=13;break}return i[l.uuid]={},t.abrupt("continue",15);case 13:h=this.duplicateItemWithoutAdding(f),i[l.uuid]={frozenValue:h,itemRef:f};case 15:a=!0,t.next=7;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(5),o=!0,s=t.t0;case 24:t.prev=24,t.prev=25,a||null==u.return||u.return();case 27:if(t.prev=27,!o){t.next=30;break}throw s;case 30:return t.finish(27);case 31:return t.finish(24);case 32:p=!0,d=!1,y=void 0,t.prev=35,v=r[Symbol.iterator]();case 37:if(p=(g=v.next()).done){t.next=52;break}if(m=g.value,k=i[m.uuid],b=k.frozenValue,w=k.itemRef,!b||w.errorDecrypting){t.next=47;break}return t.next=43,this.createDuplicateItemFromResponseItem(m);case 43:x=t.sent,m.deleted||b.isItemContentEqualWith(x)||(this.addDuplicatedItemAsConflict({duplicate:x,duplicateOf:w}),n.push(x)),t.next=49;break;case 47:n.push(m),w&&w.errorDecrypting&&(w.errorDecrypting=!1);case 49:p=!0,t.next=37;break;case 52:t.next=58;break;case 54:t.prev=54,t.t1=t.catch(35),d=!0,y=t.t1;case 58:t.prev=58,t.prev=59,p||null==v.return||v.return();case 61:if(t.prev=61,!d){t.next=64;break}throw y;case 64:return t.finish(61);case 65:return t.finish(58);case 66:return t.next=68,this.mapResponseItemsToLocalModels(n,e.MappingSourceFileImport);case 68:for(S=t.sent,_=!0,I=!1,R=void 0,t.prev=72,D=S[Symbol.iterator]();!(_=(A=D.next()).done);_=!0)C=A.value,this.setItemDirty(C,!0,!1),C.deleted=!1;t.next=80;break;case 76:t.prev=76,t.t2=t.catch(72),I=!0,R=t.t2;case 80:t.prev=80,t.prev=81,_||null==D.return||D.return();case 83:if(t.prev=83,!I){t.next=86;break}throw R;case 86:return t.finish(83);case 87:return t.finish(80);case 88:return t.abrupt("return",S);case 89:case"end":return t.stop()}},t,this,[[5,20,24,32],[25,,27,31],[35,54,58,66],[59,,61,65],[72,76,80,88],[81,,83,87]])}));return t}()},{key:"getAllItemsJSONData",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getJSONDataForItems(this.allItems,t,r,n));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"getJSONDataForItems",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return new O(e,r,n).paramsForExportFile()})).then(function(e){if(i&&0==e.length)return null;var t={items:e};return r&&(t.auth_params=n),JSON.stringify(t,null,2)}));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"computeDataIntegrityHash",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.allNondummyItems.sort(function(e,t){return t.updated_at-e.updated_at}),r=t.map(function(e){return e.updatedAtTimestamp()}),n=r.join(","),e.next=6,SFJS.crypto.sha256(n);case 6:return i=e.sent,e.abrupt("return",i);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error computing data integrity hash",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}},e,this,[[0,10]])}));return e}()},{key:"allItems",get:function(){return this.items.slice()}},{key:"allNondummyItems",get:function(){return this.items.filter(function(e){return!e.dummy})}}]),e}();n.SFModelManager=S;var I=function(){function e(t,r,n){d(this,e),this.modelManager=t,this.syncManager=r,this.singletonManager=n,this.loadPrivileges(),e.CredentialAccountPassword="CredentialAccountPassword",e.CredentialLocalPasscode="CredentialLocalPasscode",e.ActionManageExtensions="ActionManageExtensions",e.ActionManageBackups="ActionManageBackups",e.ActionViewProtectedNotes="ActionViewProtectedNotes",e.ActionManagePrivileges="ActionManagePrivileges",e.ActionManagePasscode="ActionManagePasscode",e.ActionDeleteNote="ActionDeleteNote",e.SessionExpiresAtKey="SessionExpiresAtKey",e.SessionLengthKey="SessionLengthKey",e.SessionLengthNone=0,e.SessionLengthFiveMinutes=300,e.SessionLengthOneHour=3600,e.SessionLengthOneWeek=604800,this.availableActions=[e.ActionViewProtectedNotes,e.ActionDeleteNote,e.ActionManagePasscode,e.ActionManageBackups,e.ActionManageExtensions,e.ActionManagePrivileges],this.availableCredentials=[e.CredentialAccountPassword,e.CredentialLocalPasscode],this.sessionLengths=[e.SessionLengthNone,e.SessionLengthFiveMinutes,e.SessionLengthOneHour,e.SessionLengthOneWeek,e.SessionLengthIndefinite]}return v(e,[{key:"setDelegate",value:function(e){this.delegate=e}},{key:"getAvailableActions",value:function(){return this.availableActions}},{key:"getAvailableCredentials",value:function(){return this.availableCredentials}},{key:"netCredentialsForAction",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n,i,a,o,s,u,c,l,f,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getPrivileges();case 2:t.t0=r,n=t.sent.getCredentialsForAction(t.t0),i=[],a=!0,o=!1,s=void 0,t.prev=8,u=n[Symbol.iterator]();case 10:if(a=(c=u.next()).done){t.next=27;break}if((l=c.value)!=e.CredentialAccountPassword){t.next=19;break}return t.next=15,this.delegate.isOffline();case 15:f=t.sent,f||i.push(l),t.next=24;break;case 19:if(l!=e.CredentialLocalPasscode){t.next=24;break}return t.next=22,this.delegate.hasLocalPasscode();case 22:h=t.sent,h&&i.push(l);case 24:a=!0,t.next=10;break;case 27:t.next=33;break;case 29:t.prev=29,t.t1=t.catch(8),o=!0,s=t.t1;case 33:t.prev=33,t.prev=34,a||null==u.return||u.return();case 36:if(t.prev=36,!o){t.next=39;break}throw s;case 39:return t.finish(36);case 40:return t.finish(33);case 41:return t.abrupt("return",i);case 42:case"end":return t.stop()}},t,this,[[8,29,33,41],[34,,36,40]])}));return t}()},{key:"loadPrivileges",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadPromise){e.next=2;break}return e.abrupt("return",this.loadPromise);case 2:return this.loadPromise=new Promise(function(e,r){var n=P.contentType(),i=new B("content_type","=",n);t.singletonManager.registerSingleton([i],function(r){t.privileges=r,e(r)},function(){var r=p(regeneratorRuntime.mark(function r(i){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=new P({content_type:n}),SFJS.crypto.generateUUIDSync){r.next=4;break}return r.next=4,a.initUUID();case 4:t.modelManager.addItem(a),t.modelManager.setItemDirty(a,!0),t.syncManager.sync(),i(a),e(a);case 9:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}),e.abrupt("return",this.loadPromise);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"getPrivileges",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.privileges){e.next=4;break}return e.abrupt("return",this.privileges);case 4:return e.abrupt("return",this.loadPrivileges());case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"displayInfoForCredential",value:function(t){var r={};return r[e.CredentialAccountPassword]={label:"Account Password",prompt:"Please enter your account password."},r[e.CredentialLocalPasscode]={label:"Local Passcode",prompt:"Please enter your local passcode."},r[t]}},{key:"displayInfoForAction",value:function(t){var r={};return r[e.ActionManageExtensions]={label:"Manage Extensions"},r[e.ActionManageBackups]={label:"Download/Import Backups"},r[e.ActionViewProtectedNotes]={label:"View Protected Notes"},r[e.ActionManagePrivileges]={label:"Manage Privileges"},r[e.ActionManagePasscode]={label:"Manage Passcode"},r[e.ActionDeleteNote]={label:"Delete Notes"},r[t]}},{key:"getSessionLengthOptions",value:function(){return[{value:e.SessionLengthNone,label:"Don't Remember"},{value:e.SessionLengthFiveMinutes,label:"5 Minutes"},{value:e.SessionLengthOneHour,label:"1 Hour"},{value:e.SessionLengthOneWeek,label:"1 Week"}]}},{key:"setSessionLength",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(e){var t=new Date;return t.setSeconds(t.getSeconds()+e),t},i=n(r),t.abrupt("return",Promise.all([this.delegate.saveToStorage(e.SessionExpiresAtKey,JSON.stringify(i)),this.delegate.saveToStorage(e.SessionLengthKey,JSON.stringify(r))]));case 3:case"end":return t.stop()}},t,this)}));return t}()},{key:"clearSession",value:function(){function t(){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.setSessionLength(e.SessionLengthNone));case 1:case"end":return t.stop()}},t,this)}));return t}()},{key:"getSelectedSessionLength",value:function(){function t(){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delegate.getFromStorage(e.SessionLengthKey);case 2:if(!(r=t.sent)){t.next=7;break}return t.abrupt("return",JSON.parse(r));case 7:return t.abrupt("return",e.SessionLengthNone);case 8:case"end":return t.stop()}},t,this)}));return t}()},{key:"getSessionExpirey",value:function(){function t(){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delegate.getFromStorage(e.SessionExpiresAtKey);case 2:if(!(r=t.sent)){t.next=7;break}return t.abrupt("return",new Date(JSON.parse(r)));case 7:return t.abrupt("return",new Date);case 8:case"end":return t.stop()}},t,this)}));return t}()},{key:"actionHasPrivilegesConfigured",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"actionRequiresPrivilege",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionExpirey();case 2:if(!((r=e.sent)>new Date)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.netCredentialsForAction(t);case 7:return n=e.sent,e.abrupt("return",n.length>0);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"savePrivileges",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPrivileges();case 2:t=e.sent,this.modelManager.setItemDirty(t,!0),this.syncManager.sync();case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"authenticateAction",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n,i,a,o,s,u,c,l,f,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:n=e.sent,i=[],a=[],o=!0,s=!1,u=void 0,e.prev=7,c=n[Symbol.iterator]();case 9:if(o=(l=c.next()).done){e.next=18;break}return f=l.value,e.next=13,this._verifyAuthenticationParameters(f,r[f]);case 13:h=e.sent,h?i.push(f):a.push(f);case 15:o=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),s=!0,u=e.t0;case 24:e.prev=24,e.prev=25,o||null==c.return||c.return();case 27:if(e.prev=27,!s){e.next=30;break}throw u;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",{success:0==a.length,successfulCredentials:i,failedCredentials:a});case 33:case"end":return e.stop()}},e,this,[[7,20,24,32],[25,,27,31]])}));return e}()},{key:"_verifyAuthenticationParameters",value:function(){function t(e,t){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r,n){var i,a,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.delegate.verifyAccountPassword(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a=function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.delegate.verifyLocalPasscode(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),r!=e.CredentialAccountPassword){t.next=6;break}return t.abrupt("return",i(n));case 6:if(r!=e.CredentialLocalPasscode){t.next=8;break}return t.abrupt("return",a(n));case 8:case"end":return t.stop()}},t)}));return t}()}]),e}();n.SFPrivilegesManager=I;var R=function(){function e(t,r,n,i,a){var o=this;d(this,e),this.modelManager=t,this.storageManager=r,this.$timeout=a||setTimeout.bind(window),this.keyRequestHandler=n,this.loadFromDisk().then(function(){o.modelManager.addItemSyncObserver("session-history",i,function(e,t,r,n,i){if(n!==S.MappingSourceLocalDirtied){var a=!0,s=!1,u=void 0;try{for(var c,l=e[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;try{o.addHistoryEntryForItem(f)}catch(e){console.log("Caught exception while trying to add item history entry",e)}}}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}}})})}return v(e,[{key:"encryptionParams",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.keyRequestHandler());case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"addHistoryEntryForItem",value:function(e){var t=this,r={uuid:e.uuid,content_type:e.content_type,updated_at:e.updated_at,content:e.getContentCopy()},n=this.historySession.addEntryForItem(r);this.autoOptimize&&this.historySession.optimizeHistoryForItem(e),n&&this.diskEnabled&&(this.diskTimeout&&(this.$timeout.hasOwnProperty("cancel")?this.$timeout.cancel(this.diskTimeout):clearTimeout(this.diskTimeout)),this.diskTimeout=this.$timeout(function(){t.saveToDisk()},2e3))}},{key:"historyForItem",value:function(e){return this.historySession.historyForItem(e)}},{key:"clearHistoryForItem",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearItemHistory(t),e.abrupt("return",this.saveToDisk());case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"clearAllHistory",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearAllHistory(),e.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"toggleDiskSaving",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.diskEnabled=!this.diskEnabled,!this.diskEnabled){e.next=6;break}this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!0)),this.saveToDisk(),e.next=8;break;case 6:return this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!1)),e.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveToDisk",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.diskEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.encryptionParams();case 4:t=e.sent,r=new O(this.historySession,t.keys,t.auth_params),r.paramsForSync().then(function(e){n.storageManager.setItem("sessionHistory_revisions",JSON.stringify(e))});case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"loadFromDisk",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageManager.getItem("sessionHistory_persist");case 2:return t=e.sent,t&&(this.diskEnabled=JSON.parse(t)),e.next=6,this.storageManager.getItem("sessionHistory_revisions");case 6:if(!(r=e.sent)){e.next=18;break}return r=JSON.parse(r),e.next=11,this.encryptionParams();case 11:return n=e.sent,e.next=14,SFJS.itemTransformer.decryptItem(r,n.keys);case 14:i=new E(r),this.historySession=i,e.next=19;break;case 18:this.historySession=new E;case 19:return e.next=21,this.storageManager.getItem("sessionHistory_autoOptimize");case 21:a=e.sent,this.autoOptimize=!a||JSON.parse(a);case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"toggleAutoOptimize",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.autoOptimize=!this.autoOptimize,this.autoOptimize?this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!0)):this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!1));case 2:case"end":return e.stop()}},e,this)}));return e}()}]),e}();n.SFSessionHistoryManager=R;var D=function(){function e(t,r){var n=this;d(this,e),this.syncManager=r,this.modelManager=t,this.singletonHandlers=[],t.addItemSyncObserverWithPriority({id:"sf-singleton-manager",types:"*",priority:-1,callback:function(e,r,i,a,o){a!==S.MappingSourceLocalDirtied&&n.resolveSingletons(t.allNondummyItems,null,!0)}}),r.addEventHandler(function(e,r){if("local-data-loaded"==e)n.resolveSingletons(t.allNondummyItems,null,!0),n.initialDataLoaded=!0;else if("sync:completed"==e){if(!n.initialDataLoaded)return;n.resolveSingletons(r.retrievedItems,r.savedItems)}}),t.addModelUuidChangeObserver("singleton-manager",function(e,t){var r=!0,i=!1,a=void 0;try{for(var o,s=n.singletonHandlers[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;u.singleton&&B.ItemSatisfiesPredicates(t,u.predicates)&&(u.singleton=null,n.resolveSingletons([t]))}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}})}return v(e,[{key:"registerSingleton",value:function(e,t,r){this.singletonHandlers.push({predicates:e,resolutionCallback:t,createBlock:r})}},{key:"resolveSingletons",value:function(e,t,r){var n=this;e=e||[],t=t||[];var i=!0,a=!1,o=void 0;try{for(var s,u=this.singletonHandlers[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)!function(){var i=s.value,a=i.predicates.slice(),o=n.modelManager.filterItemsWithPredicates(e,a),u=function(){i.createBlock&&(i.pendingCreateBlockCallback=!0,i.createBlock(function(e){i.singleton=e,i.pendingCreateBlockCallback=!1,i.resolutionCallback&&i.resolutionCallback(e)}))},c=n.modelManager.filterItemsWithPredicates(t,a).length;if(o.length>0||c>0){var l=n.modelManager.itemsMatchingPredicates(a);if(l.length>=2){var f=l.sort(function(e,t){return e.errorDecrypting?1:t.errorDecrypting?-1:e.created_at<t.created_at?-1:1}),h=f[0],p=f.slice(1,f.length),d=!0,y=!1,v=void 0;try{for(var g,m=p[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var k=g.value;n.modelManager.setItemToBeDeleted(k)}}catch(e){y=!0,v=e}finally{try{d||null==m.return||m.return()}finally{if(y)throw v}}n.syncManager.sync(),i.singleton=h,i.resolutionCallback&&i.resolutionCallback(h)}else if(1==l.length){var b=l[0];b.errorDecrypting?(n.modelManager.setItemToBeDeleted(b),u()):i.singleton&&i.singleton===b||(i.singleton=b,i.resolutionCallback&&i.resolutionCallback(b))}}else i.singleton||r||i.pendingCreateBlockCallback||u()}()}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}}]),e}();n.SFSingletonManager=D;var A=function(){function e(){d(this,e)}return v(e,[{key:"setItem",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"getItem",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"removeItem",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"clear",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"getAllModels",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"saveModel",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveModels([t]));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveModels",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"deleteModel",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"clearAllModels",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return e}()},{key:"clearAllData",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.clear(),this.clearAllModels()]));case 1:case"end":return e.stop()}},e,this)}));return e}()}]),e}();n.SFStorageManager=A;var C=function(){function e(t,r,n,i,a){d(this,e),e.KeyRequestLoadLocal="KeyRequestLoadLocal",e.KeyRequestSaveLocal="KeyRequestSaveLocal",e.KeyRequestLoadSaveAccount="KeyRequestLoadSaveAccount",this.httpManager=n,this.modelManager=t,this.storageManager=r,this.$interval=a||setInterval.bind(window),this.$timeout=i||setTimeout.bind(window),this.syncStatus={},this.syncStatusObservers=[],this.eventHandlers=[],this.PerSyncItemUploadLimit=150,this.ServerItemDownloadLimit=150,this.MajorDataChangeThreshold=15,this.MaxDiscordanceBeforeOutOfSync=5,this.syncDiscordance=0,this.outOfSync=!1}return v(e,[{key:"handleServerIntegrityHash",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!=t.length){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.modelManager.computeDataIntegrityHash();case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:if(r===t){e.next=13;break}return this.syncDiscordance++,this.syncDiscordance>=this.MaxDiscordanceBeforeOutOfSync&&(this.outOfSync||(this.outOfSync=!0,this.notifyEvent("enter-out-of-sync"))),e.abrupt("return",!1);case 13:return this.outOfSync&&(this.outOfSync=!1,this.notifyEvent("exit-out-of-sync")),this.syncDiscordance=0,e.abrupt("return",!0);case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"isOutOfSync",value:function(){return this.outOfSync}},{key:"getServerURL",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageManager.getItem("server");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=window._default_sf_server;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSyncURL",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getServerURL();case 2:return e.t0=e.sent,e.abrupt("return",e.t0+"/items/sync");case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"registerSyncStatusObserver",value:function(e){var t={key:new Date,callback:e};return this.syncStatusObservers.push(t),t}},{key:"removeSyncStatusObserver",value:function(e){_.pull(this.syncStatusObservers,e)}},{key:"syncStatusDidChange",value:function(){var e=this;this.syncStatusObservers.forEach(function(t){t.callback(e.syncStatus)})}},{key:"addEventHandler",value:function(e){return this.eventHandlers.push(e),e}},{key:"removeEventHandler",value:function(e){_.pull(this.eventHandlers,e)}},{key:"notifyEvent",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=this.eventHandlers[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){(0,a.value)(e,t||{})}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"setKeyRequestHandler",value:function(e){this.keyRequestHandler=e}},{key:"getActiveKeyInfo",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.keyRequestHandler(t));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"initialDataLoaded",value:function(){return!0===this._initialDataLoaded}},{key:"_sortLocalItems",value:function(e){var t=this;return e.sort(function(e,r){var n=new Date(r.updated_at)-new Date(e.updated_at),i=t.contentTypeLoadPriority,a=0,o=0;return i&&(a=i.indexOf(e.content_type),o=i.indexOf(r.content_type),-1==a&&(a=i.length),-1==o&&(o=i.length)),a==o?n:a<o?-1:1})}},{key:"loadLocalItems",value:function(){function t(){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(){var r,n,i,a,o,s=this,u=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=u.length>0&&void 0!==u[0]?u[0]:{},n=r.incrementalCallback,i=r.batchSize,a=r.options,!a||!a.simulateHighLatency){t.next=5;break}return o=a.simulatedLatency||1e3,t.next=5,this._awaitSleep(o);case 5:if(!this.loadLocalDataPromise){t.next=7;break}return t.abrupt("return",this.loadLocalDataPromise);case 7:return i||(i=100),this.loadLocalDataPromise=this.storageManager.getAllModels().then(function(t){t=s._sortLocalItems(t),t=t.filter(function(e){var t=s.modelManager.findItem(e.uuid);return!t||new Date(e.dirtiedDate)>t.dirtiedDate});var r=t.length,a=0,o=[],u=function(){var c=p(regeneratorRuntime.mark(function c(){var l,f;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return l=t.slice(a,a+i),c.next=3,s.handleItemsResponse(l,null,S.MappingSourceLocalRetrieved,e.KeyRequestLoadLocal);case 3:if(f=c.sent,o.push(f),!((a+=l.length)<r)){c.next=10;break}return c.abrupt("return",new Promise(function(e,t){s.$timeout(function(){s.notifyEvent("local-data-incremental-load"),n&&n(a,r),u().then(e)})}));case 10:s._initialDataLoaded=!0,s.notifyEvent("local-data-loaded");case 12:case"end":return c.stop()}},c)}));return function(){return c.apply(this,arguments)}}();return u()}),t.abrupt("return",this.loadLocalDataPromise);case 10:case"end":return t.stop()}},t,this)}));return t}()},{key:"writeItemsToLocalStorage",value:function(){function t(e,t){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r,n){var i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=r.length){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise(function(){var t=p(regeneratorRuntime.mark(function t(a,o){var s,u,c,l,f,h,d,y,v,g;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(s=[],u=[],c=!0,l=!1,f=void 0,t.prev=4,h=r[Symbol.iterator]();!(c=(d=h.next()).done);c=!0)y=d.value,!0!==y.deleted||y.dirty?s.push(y):u.push(y);t.next=12;break;case 8:t.prev=8,t.t0=t.catch(4),l=!0,f=t.t0;case 12:t.prev=12,t.prev=13,c||null==h.return||h.return();case 15:if(t.prev=15,!l){t.next=18;break}throw f;case 18:return t.finish(15);case 19:return t.finish(12);case 20:if(!(u.length>0)){t.next=23;break}return t.next=23,Promise.all(u.map(function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.storageManager.deleteModel(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 23:return t.next=25,i.getActiveKeyInfo(e.KeyRequestSaveLocal);case 25:if(v=t.sent,!(s.length>0)){t.next=33;break}return t.next=29,Promise.all(s.map(function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new O(t,v.keys,v.auth_params),e.next=3,r.paramsForLocalStorage();case 3:return r=e.sent,n&&delete r.dirty,e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).catch(function(e){return o(e)});case 29:return g=t.sent,t.next=32,i.storageManager.saveModels(g).catch(function(e){console.error("Error writing items",e),i.syncStatus.localError=e,i.syncStatusDidChange(),o()});case 32:i.syncStatus.localError&&(i.syncStatus.localError=null,i.syncStatusDidChange());case 33:a();case 34:case"end":return t.stop()}},t,null,[[4,8,12,20],[13,,15,19]])}));return function(e,r){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t)}));return t}()},{key:"syncOffline",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n,i,a,o,s,u=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=!0,n=!1,i=void 0,e.prev=3,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0)s=o.value,s.updated_at=new Date;e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),n=!0,i=e.t0;case 11:e.prev=11,e.prev=12,r||null==a.return||a.return();case 14:if(e.prev=14,!n){e.next=17;break}throw i;case 17:return e.finish(14);case 18:return e.finish(11);case 19:return e.abrupt("return",this.writeItemsToLocalStorage(t,!0).then(function(e){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.deleted&&u.modelManager.removeItemLocally(s)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return u.modelManager.clearDirtyItems(t),u.modelManager.didSyncModelsOffline(t),u.notifyEvent("sync:completed",{savedItems:t}),{saved_items:t}}));case 20:case"end":return e.stop()}},e,this,[[3,7,11,19],[12,,14,18]])}));return e}()},{key:"markAllItemsDirtyAndSaveOffline",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n,i,a,o,s,u,c,l,f,h,p,d,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=28;break}r=this.modelManager.allNondummyItems.filter(function(e){return!e.errorDecrypting}).slice(),n=!0,i=!1,a=void 0,e.prev=5,o=r[Symbol.iterator]();case 7:if(n=(s=o.next()).done){e.next=14;break}return u=s.value,e.next=11,this.modelManager.alternateUUIDForItem(u);case 11:n=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),i=!0,a=e.t0;case 20:e.prev=20,e.prev=21,n||null==o.return||o.return();case 23:if(e.prev=23,!i){e.next=26;break}throw a;case 26:return e.finish(23);case 27:return e.finish(20);case 28:for(c=this.modelManager.allNondummyItems,l=!0,f=!1,h=void 0,e.prev=32,p=c[Symbol.iterator]();!(l=(d=p.next()).done);l=!0)y=d.value,y.setDirty(!0);e.next=40;break;case 36:e.prev=36,e.t1=e.catch(32),f=!0,h=e.t1;case 40:e.prev=40,e.prev=41,l||null==p.return||p.return();case 43:if(e.prev=43,!f){e.next=46;break}throw h;case 46:return e.finish(43);case 47:return e.finish(40);case 48:return e.abrupt("return",this.writeItemsToLocalStorage(c,!1));case 49:case"end":return e.stop()}},e,this,[[5,16,20,28],[21,,23,27],[32,36,40,48],[41,,43,47]])}));return e}()},{key:"setSyncToken",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._syncToken=t,e.next=3,this.storageManager.setItem("syncToken",t);case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSyncToken",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._syncToken){e.next=4;break}return e.next=3,this.storageManager.getItem("syncToken");case 3:this._syncToken=e.sent;case 4:return e.abrupt("return",this._syncToken);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"setCursorToken",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cursorToken=t,!t){e.next=6;break}return e.next=4,this.storageManager.setItem("cursorToken",t);case 4:e.next=8;break;case 6:return e.next=8,this.storageManager.removeItem("cursorToken");case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"getCursorToken",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cursorToken){e.next=4;break}return e.next=3,this.storageManager.getItem("cursorToken");case 3:this._cursorToken=e.sent;case 4:return e.abrupt("return",this._cursorToken);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"clearQueuedCallbacks",value:function(){this._queuedCallbacks=[]}},{key:"callQueuedCallbacks",value:function(e){var t=this.queuedCallbacks;if(t.length){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){(0,a.value)(e)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}this.clearQueuedCallbacks()}}},{key:"beginCheckingIfSyncIsTakingTooLong",value:function(){this.syncStatus.checker&&this.stopCheckingIfSyncIsTakingTooLong(),this.syncStatus.checker=this.$interval(function(){(new Date-this.syncStatus.syncStart)/1e3>5&&(this.notifyEvent("sync:taking-too-long"),this.stopCheckingIfSyncIsTakingTooLong())}.bind(this),500)}},{key:"stopCheckingIfSyncIsTakingTooLong",value:function(){this.$interval.hasOwnProperty("cancel")?this.$interval.cancel(this.syncStatus.checker):clearInterval(this.syncStatus.checker),this.syncStatus.checker=null}},{key:"lockSyncing",value:function(){this.syncLocked=!0}},{key:"unlockSyncing",value:function(){this.syncLocked=!1}},{key:"sync",value:function(){function t(){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(){var r,n=this,i=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>0&&void 0!==i[0]?i[0]:{},!this.syncLocked){t.next=4;break}return console.log("Sync Locked, Returning;"),t.abrupt("return");case 4:return t.abrupt("return",new Promise(function(){var t=p(regeneratorRuntime.mark(function t(i,a){var o,s,u,c,l,f,h,p,d,y,v,g,m,k,b;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r||(r={}),o=n.modelManager.getDirtyItems(),s=o.filter(function(e){return!n.lastDirtyItemsSave||e.dirtiedDate>n.lastDirtyItemsSave}),t.next=5,n.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 5:if(u=t.sent,c=n.syncStatus.syncOpInProgress,l=n.initialDataLoaded(),!c&&l){t.next=16;break}return n.performSyncAgainOnCompletion=!0,n.lastDirtyItemsSave=new Date,t.next=13,n.writeItemsToLocalStorage(s,!1);case 13:return c&&(n.queuedCallbacks.push(i),n.loggingEnabled&&console.warn("Attempting to sync while existing sync is in progress.")),l||(n.loggingEnabled&&console.warn("(1) Attempting to perform online sync before local data has loaded"),i()),t.abrupt("return");case 16:if(n.syncStatus.syncOpInProgress=!0,!u.offline){t.next=19;break}return t.abrupt("return",n.syncOffline(o).then(function(e){n.syncStatus.syncOpInProgress=!1,i(e)}).catch(function(e){n.notifyEvent("sync-exception",e)}));case 19:if(n.initialDataLoaded()){t.next=22;break}return console.error("Attempting to perform online sync before local data has loaded"),t.abrupt("return");case 22:return n.loggingEnabled&&console.log("Syncing online user."),f=n.syncStatus.needsMoreSync,n.syncStatus.syncStart=new Date,n.beginCheckingIfSyncIsTakingTooLong(),h=n.PerSyncItemUploadLimit,p=o.slice(0,h),p.length<o.length?n.syncStatus.needsMoreSync=!0:n.syncStatus.needsMoreSync=!1,f||(n.syncStatus.total=o.length,n.syncStatus.current=0),n.syncStatus.current>n.syncStatus.total&&(n.syncStatus.total=n.syncStatus.current),n.syncStatusDidChange(),t.next=34,n.writeItemsToLocalStorage(s,!1);case 34:return n.lastDirtyItemsSave=new Date,r.onPreSyncSave&&r.onPreSyncSave(),n.allRetreivedItems||(n.allRetreivedItems=[]),n.allSavedItems||(n.allSavedItems=[]),d={},d.limit=n.ServerItemDownloadLimit,r.performIntegrityCheck&&(d.compute_integrity=!0),t.prev=41,t.next=44,Promise.all(p.map(function(e){var t=new O(e,u.keys,u.auth_params);return t.additionalFields=r.additionalFields,t.paramsForSync()})).then(function(e){d.items=e});case 44:t.next=49;break;case 46:t.prev=46,t.t0=t.catch(41),n.notifyEvent("sync-exception",t.t0);case 49:for(y=!0,v=!1,g=void 0,t.prev=52,m=p[Symbol.iterator]();!(y=(k=m.next()).done);y=!0)b=k.value,b.dirtyCount=0;t.next=60;break;case 56:t.prev=56,t.t1=t.catch(52),v=!0,g=t.t1;case 60:t.prev=60,t.prev=61,y||null==m.return||m.return();case 63:if(t.prev=63,!v){t.next=66;break}throw g;case 66:return t.finish(63);case 67:return t.finish(60);case 68:return t.next=70,n.getSyncToken();case 70:return d.sync_token=t.sent,t.next=73,n.getCursorToken();case 73:return d.cursor_token=t.sent,d.api=w.getApiVersion(),n.loggingEnabled&&console.log("Syncing with params",d),t.prev=76,t.t2=n.httpManager,t.next=80,n.getSyncURL();case 80:t.t3=t.sent,t.t4=d,t.t5=function(e){n.handleSyncSuccess(p,e,r).then(function(){i(e)}).catch(function(e){console.log("Caught sync success exception:",e),n.handleSyncError(e,null,o).then(function(t){n.notifyEvent("sync-exception",e),i(t)})})},t.t6=function(e,t){n.handleSyncError(e,t,o).then(function(e){i(e)})},t.t2.postAuthenticatedAbsolute.call(t.t2,t.t3,t.t4,t.t5,t.t6),t.next=90;break;case 87:t.prev=87,t.t7=t.catch(76),console.log("Sync exception caught:",t.t7);case 90:case"end":return t.stop()}},t,null,[[41,46],[52,56,60,68],[61,,63,67],[76,87]])}));return function(e,r){return t.apply(this,arguments)}}()));case 5:case"end":return t.stop()}},t,this)}));return t}()},{key:"_awaitSleep",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Simulating high latency sync request",t),e.abrupt("return",new Promise(function(e,r){setTimeout(function(){e()},t)}));case 2:case"end":return e.stop()}},e)}));return e}()},{key:"handleSyncSuccess",value:function(){function t(e,t,n){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r,n,i){var a,o,s,u,c,l,f,h,p,d,y,v,g,m,k,b,w,x,_=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.simulateHighLatency){t.next=4;break}return a=i.simulatedLatency||1e3,t.next=4,this._awaitSleep(a);case 4:for(this.syncStatus.error=null,this.loggingEnabled&&console.log("Sync response",n),o=this.allSavedItems.map(function(e){return e.uuid}),s=n.saved_items.map(function(e){return e.uuid}),n.retrieved_items=n.retrieved_items.filter(function(e){var t=o.includes(e.uuid),r=s.includes(e.uuid);if(t||r)return!1;var n=_.modelManager.findItem(e.uuid);return!n||!n.dirty}),u=[],c=!0,l=!1,f=void 0,t.prev=13,h=r[Symbol.iterator]();!(c=(p=h.next()).done);c=!0)d=p.value,0==d.dirtyCount&&u.push(d);t.next=21;break;case 17:t.prev=17,t.t0=t.catch(13),l=!0,f=t.t0;case 21:t.prev=21,t.prev=22,c||null==h.return||h.return();case 24:if(t.prev=24,!l){t.next=27;break}throw f;case 27:return t.finish(24);case 28:return t.finish(21);case 29:return this.modelManager.clearDirtyItems(u),t.next=32,this.handleItemsResponse(n.retrieved_items,null,S.MappingSourceRemoteRetrieved,e.KeyRequestLoadSaveAccount);case 32:return y=t.sent,this.allRetreivedItems=this.allRetreivedItems.concat(y),this.syncStatus.retrievedCount=this.allRetreivedItems.length,v=["content","auth_hash"],t.next=38,this.handleItemsResponse(n.saved_items,v,S.MappingSourceRemoteSaved,e.KeyRequestLoadSaveAccount);case 38:return g=t.sent,this.allSavedItems=this.allSavedItems.concat(g),m=n.unsaved,t.next=43,this.deprecated_handleUnsavedItemsResponse(m);case 43:return t.next=45,this.handleConflictsResponse(n.conflicts);case 45:if(k=t.sent,b=k&&k.length>0,!k){t.next=50;break}return t.next=50,this.writeItemsToLocalStorage(k,!1);case 50:return t.next=52,this.writeItemsToLocalStorage(g,!1);case 52:return t.next=54,this.writeItemsToLocalStorage(y,!1);case 54:if(!n.integrity_hash||n.cursor_token){t.next=59;break}return t.next=57,this.handleServerIntegrityHash(n.integrity_hash);case 57:w=t.sent,w||this.syncDiscordance<this.MaxDiscordanceBeforeOutOfSync&&(this.performSyncAgainOnCompletion=!0);case 59:return this.syncStatus.syncOpInProgress=!1,this.syncStatus.current+=r.length,this.syncStatusDidChange(),this.setSyncToken(n.sync_token),this.setCursorToken(n.cursor_token),this.stopCheckingIfSyncIsTakingTooLong(),t.next=67,this.getCursorToken();case 67:if(!(x=t.sent)&&!this.syncStatus.needsMoreSync){t.next=72;break}return t.abrupt("return",new Promise(function(e,t){setTimeout(function(){this.sync(i).then(e)}.bind(_),10)}));case 72:if(!b){t.next=77;break}return this.performSyncAgainOnCompletion=!1,t.abrupt("return",new Promise(function(e,t){setTimeout(function(){_.sync(i).then(e)},10)}));case 77:return this.syncStatus.retrievedCount=0,this.syncStatus.current=0,this.syncStatus.total=0,this.syncStatusDidChange(),(this.allRetreivedItems.length>=this.majorDataChangeThreshold||g.length>=this.majorDataChangeThreshold||m&&m.length>=this.majorDataChangeThreshold||k&&k.length>=this.majorDataChangeThreshold)&&this.notifyEvent("major-data-change"),this.callQueuedCallbacks(n),this.notifyEvent("sync:completed",{retrievedItems:this.allRetreivedItems,savedItems:this.allSavedItems}),this.allRetreivedItems=[],this.allSavedItems=[],this.performSyncAgainOnCompletion&&(this.performSyncAgainOnCompletion=!1,setTimeout(function(){_.sync(i)},10)),t.abrupt("return",n);case 88:case"end":return t.stop()}},t,this,[[13,17,21,29],[22,,24,28]])}));return t}()},{key:"handleSyncError",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sync error: ",t),401==r&&this.notifyEvent("sync-session-invalid"),t?"string"==typeof t&&(t={error:{message:t}}):t={error:{message:"Could not connect to server."}},this.syncStatus.syncOpInProgress=!1,this.syncStatus.error=t.error,this.syncStatusDidChange(),this.writeItemsToLocalStorage(n,!1),this.modelManager.didSyncModelsOffline(n),this.stopCheckingIfSyncIsTakingTooLong(),this.notifyEvent("sync:error",t.error),this.callQueuedCallbacks({error:"Sync error"}),e.abrupt("return",t);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"handleItemsResponse",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){var a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getActiveKeyInfo(i);case 2:return a=e.sent.keys,e.next=5,SFJS.itemTransformer.decryptMultipleItems(t,a);case 5:return e.next=7,this.modelManager.mapResponseItemsToLocalModelsOmittingFields(t,r,n);case 7:return o=e.sent,s=o.filter(function(e){var t=e.errorDecryptingValueChanged;return e.errorDecryptingValueChanged=!1,t}),s.length>0&&this.writeItemsToLocalStorage(s,!1),e.abrupt("return",o);case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"refreshErroredItems",value:function(){function t(){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.modelManager.allNondummyItems.filter(function(e){return 1==e.errorDecrypting}),!(r.length>0)){t.next=3;break}return t.abrupt("return",this.handleItemsResponse(r,null,S.MappingSourceLocalRetrieved,e.KeyRequestLoadSaveAccount));case 3:case"end":return t.stop()}},t,this)}));return t}()},{key:"handleConflictsResponse",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n,i,a,o,s,u,c,l,f,h,p,d,y,v,g,m,k,b,w,x,_,I,R,D,A,C,M,O,B,P,E,T,j,L,H;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&0!=r.length){t.next=2;break}return t.abrupt("return");case 2:this.loggingEnabled&&console.log("Handle Conflicted Items:",r),n={},i=!0,a=!1,o=void 0,t.prev=7,s=r[Symbol.iterator]();case 9:if(i=(u=s.next()).done){t.next=21;break}if(c=u.value,l=c.server_item||c.unsaved_item,f=this.modelManager.findItem(l.uuid)){t.next=16;break}return n[l.uuid]={},t.abrupt("continue",18);case 16:h=f.getContentCopy(),n[l.uuid]={frozenContent:h,itemRef:f};case 18:i=!0,t.next=9;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(7),a=!0,o=t.t0;case 27:t.prev=27,t.prev=28,i||null==s.return||s.return();case 30:if(t.prev=30,!a){t.next=33;break}throw o;case 33:return t.finish(30);case 34:return t.finish(27);case 35:p=[],d=!0,y=!1,v=void 0,t.prev=39,g=r[Symbol.iterator]();case 41:if(d=(m=g.next()).done){t.next=91;break}return k=m.value,b=k.server_item||k.unsaved_item,t.t1=SFJS.itemTransformer,t.t2=[b],t.next=48,this.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 48:return t.t3=t.sent.keys,t.next=51,t.t1.decryptMultipleItems.call(t.t1,t.t2,t.t3);case 51:if(w=n[b.uuid],x=w.frozenContent,_=w.itemRef,_){t.next=54;break}return t.abrupt("continue",88);case 54:if(p.push(_),"uuid_conflict"!==k.type){t.next=62;break}return t.next=58,this.modelManager.alternateUUIDForItem(_);case 58:I=t.sent,p.push(I),t.next=88;break;case 62:if("sync_conflict"!==k.type){t.next=86;break}return t.next=65,this.modelManager.createDuplicateItemFromResponseItem(b);case 65:if(R=t.sent,D=this.modelManager.duplicateItemWithCustomContent({content:x,duplicateOf:_}),A=!D.isItemContentEqualWith(R),C=!_.isItemContentEqualWith(R),M=!1,O=!1,B=!1,P=!1,b.deleted||_.deleted?P=!0:A?(E=20,T=(new Date-_.client_updated_at)/1e3<E,T?(B=!0,O=!0):(M=!0,P=!0)):C?(j=!F.AreItemContentsEqual({leftContent:_.content,rightContent:R.content,keysToIgnore:_.keysToIgnoreWhenCheckingContentEquality().concat(["references"]),appDataKeysToIgnore:_.appDataKeysToIgnoreWhenCheckingContentEquality()}),L=!j,L?B=!0:(M=!0,P=!0)):P=!0,!M){t.next=79;break}return t.next=77,this.modelManager.duplicateItemWithCustomContentAndAddAsConflict({content:x,duplicateOf:_});case 77:H=t.sent,p.push(H);case 79:if(O&&(this.modelManager.addDuplicatedItemAsConflict({duplicate:R,duplicateOf:_}),p.push(R)),!P){t.next=83;break}return t.next=83,this.modelManager.mapResponseItemsToLocalModelsOmittingFields([b],null,S.MappingSourceRemoteRetrieved);case 83:B&&(_.updated_at=R.updated_at,_.setDirty(!0)),t.next=88;break;case 86:return console.error("Unsupported conflict type",k.type),t.abrupt("continue",88);case 88:d=!0,t.next=41;break;case 91:t.next=97;break;case 93:t.prev=93,t.t4=t.catch(39),y=!0,v=t.t4;case 97:t.prev=97,t.prev=98,d||null==g.return||g.return();case 100:if(t.prev=100,!y){t.next=103;break}throw v;case 103:return t.finish(100);case 104:return t.finish(97);case 105:return t.abrupt("return",p);case 106:case"end":return t.stop()}},t,this,[[7,23,27,35],[28,,30,34],[39,93,97,105],[98,,100,104]])}));return t}()},{key:"deprecated_handleUnsavedItemsResponse",value:function(){function t(e){return r.apply(this,arguments)}var r=p(regeneratorRuntime.mark(function t(r){var n,i,a,o,s,u,c,l,f,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&0!=r.length){t.next=2;break}return t.abrupt("return");case 2:this.loggingEnabled&&console.log("Handle Unsaved Items:",r),n=!0,i=!1,a=void 0,t.prev=6,o=r[Symbol.iterator]();case 8:if(n=(s=o.next()).done){t.next=35;break}return u=s.value,c=u.item,t.t0=SFJS.itemTransformer,t.t1=[c],t.next=15,this.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 15:return t.t2=t.sent.keys,t.next=18,t.t0.decryptMultipleItems.call(t.t0,t.t1,t.t2);case 18:if(l=this.modelManager.findItem(c.uuid)){t.next=21;break}return t.abrupt("continue",32);case 21:if(f=u.error,"uuid_conflict"!==f.tag){t.next=27;break}return t.next=25,this.modelManager.alternateUUIDForItem(l);case 25:t.next=32;break;case 27:if("sync_conflict"!==f.tag){t.next=32;break}return t.next=30,this.modelManager.createDuplicateItemFromResponseItem(c);case 30:h=t.sent,c.deleted||l.isItemContentEqualWith(h)||this.modelManager.addDuplicatedItemAsConflict({duplicate:h,duplicateOf:l});case 32:n=!0,t.next=8;break;case 35:t.next=41;break;case 37:t.prev=37,t.t3=t.catch(6),i=!0,a=t.t3;case 41:t.prev=41,t.prev=42,n||null==o.return||o.return();case 44:if(t.prev=44,!i){t.next=47;break}throw a;case 47:return t.finish(44);case 48:return t.finish(41);case 49:case"end":return t.stop()}},t,this,[[6,37,41,49],[42,,44,48]])}));return t}()},{key:"stateless_downloadAllItems",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(){var n=p(regeneratorRuntime.mark(function n(i,a){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o={limit:r.limit||500,sync_token:r.syncToken,cursor_token:r.cursorToken,content_type:r.contentType,event:r.event,api:w.getApiVersion()},n.prev=1,n.t0=t.httpManager,n.next=5,t.getSyncURL();case 5:n.t1=n.sent,n.t2=o,n.t3=function(){var n=p(regeneratorRuntime.mark(function n(a){var o,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r.retrievedItems||(r.retrievedItems=[]),o=a.retrieved_items,n.next=4,t.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 4:return s=n.sent.keys,n.next=7,SFJS.itemTransformer.decryptMultipleItems(o,s);case 7:r.retrievedItems=r.retrievedItems.concat(o.map(function(e){return t.modelManager.createItem(e)})),r.syncToken=a.sync_token,r.cursorToken=a.cursor_token,r.cursorToken?t.stateless_downloadAllItems(r).then(i):i(r.retrievedItems);case 11:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),n.t4=function(e,t){a(e)},n.t0.postAuthenticatedAbsolute.call(n.t0,n.t1,n.t2,n.t3,n.t4),n.next=16;break;case 12:n.prev=12,n.t5=n.catch(1),console.log("Download all items exception caught:",n.t5),a(n.t5);case 16:case"end":return n.stop()}},n,null,[[1,12]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"resolveOutOfSync",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stateless_downloadAllItems({event:"resolve-out-of-sync"}).then(function(){var e=p(regeneratorRuntime.mark(function e(r){var n,i,a,o,s,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=!0,a=!1,o=void 0,e.prev=4,s=r[Symbol.iterator]();case 6:if(i=(u=s.next()).done){e.next=18;break}if(c=u.value,!(l=t.modelManager.findItem(c.uuid))){e.next=14;break}if(!(f=!c.isItemContentEqualWith(l))){e.next=14;break}return e.next=14,t.modelManager.duplicateItemAndAddAsConflict(l);case 14:n.push(c);case 15:i=!0,e.next=6;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(4),a=!0,o=e.t0;case 24:e.prev=24,e.prev=25,i||null==s.return||s.return();case 27:if(e.prev=27,!a){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.next=34,t.modelManager.mapResponseItemsToLocalModelsWithOptions({items:n,source:S.MappingSourceRemoteRetrieved});case 34:return e.next=36,t.writeItemsToLocalStorage(t.modelManager.allNondummyItems);case 36:return e.abrupt("return",t.sync({performIntegrityCheck:!0}));case 37:case"end":return e.stop()}},e,null,[[4,20,24,32],[25,,27,31]])}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"handleSignout",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.outOfSync=!1,this.loadLocalDataPromise=null,this.performSyncAgainOnCompletion=!1,this.syncStatus.syncOpInProgress=!1,this._queuedCallbacks=[],this.syncStatus={},e.abrupt("return",this.clearSyncToken());case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"clearSyncToken",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._syncToken=null,this._cursorToken=null,e.abrupt("return",this.storageManager.removeItem("syncToken"));case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"__setLocalDataNotLoaded",value:function(){this.loadLocalDataPromise=null,this._initialDataLoaded=!1}},{key:"queuedCallbacks",get:function(){return this._queuedCallbacks||(this._queuedCallbacks=[]),this._queuedCallbacks}}]),e}();n.SFSyncManager=C;var M,F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,e),this.content={},this.referencingObjects=[],this.updateFromJSON(t),this.uuid||"undefined"!=typeof SFJS&&SFJS.crypto.generateUUIDSync&&(this.uuid=SFJS.crypto.generateUUIDSync()),"object"!==f(this.content)||this.content.references||(this.content.references=[])}return v(e,[{key:"initUUID",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uuid){e.next=4;break}return e.next=3,SFJS.crypto.generateUUID();case 3:this.uuid=e.sent;case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"updateFromJSON",value:function(t){if(t){this.deleted=t.deleted,this.uuid=t.uuid,this.enc_item_key=t.enc_item_key,this.auth_hash=t.auth_hash,this.auth_params=t.auth_params;for(var r=["errorDecrypting","dirty","dirtyCount","dirtiedDate","dummy"],n=0,i=r;n<i.length;n++){var a=i[n];void 0!==t[a]&&(this[a]=t[a])}if(this.dirtiedDate&&"string"==typeof this.dirtiedDate&&(this.dirtiedDate=new Date(this.dirtiedDate)),this.content_type||(this.content_type=t.content_type),t.errorDecrypting)this.content=t.content;else try{var o="string"==typeof t.content?JSON.parse(t.content):t.content;e.deepMerge(this.contentObject,o)}catch(e){console.log("Error while updating item from json",e)}t.created_at&&(this.created_at=t.created_at),t.updated_at&&(this.updated_at=t.updated_at),this.created_at?this.created_at=new Date(this.created_at):this.created_at=new Date,this.updated_at?this.updated_at=new Date(this.updated_at):this.updated_at=new Date(0),this._client_updated_at=null,t.content?this.mapContentToLocalProperties(this.contentObject):1==t.deleted&&this.handleDeletedContent()}}},{key:"mapContentToLocalProperties",value:function(e){}},{key:"createContentJSONFromProperties",value:function(){var t=this.structureParams();return e.deepMerge(this.contentObject,t),t}},{key:"structureParams",value:function(){return this.getContentCopy()}},{key:"handleDeletedContent",value:function(){}},{key:"setDirty",value:function(e,t){this.dirty=e,this.dirtyCount||(this.dirtyCount=0),e?this.dirtyCount++:this.dirtyCount=0,this.dirtiedDate=new Date,e&&t?this.client_updated_at=new Date:this.hasRawClientUpdatedAtValue()||(this.client_updated_at=new Date(this.updated_at))}},{key:"updateLocalRelationships",value:function(){}},{key:"addItemAsRelationship",value:function(e){if(e.setIsBeingReferencedBy(this),!this.hasRelationshipWithItem(e)){var t=this.content.references||[];t.push({uuid:e.uuid,content_type:e.content_type}),this.content.references=t}}},{key:"removeItemAsRelationship",value:function(e){e.setIsNoLongerBeingReferencedBy(this),this.removeReferenceWithUuid(e.uuid)}},{key:"setIsBeingReferencedBy",value:function(e){_.find(this.referencingObjects,{uuid:e.uuid})||this.referencingObjects.push(e)}},{key:"setIsNoLongerBeingReferencedBy",value:function(e){_.remove(this.referencingObjects,{uuid:e.uuid}),this.hasRelationshipWithItem(e)&&(this.removeReferenceWithUuid(e.uuid),this.setDirty(!0))}},{key:"removeReferenceWithUuid",value:function(e){var t=this.content.references||[];t=t.filter(function(t){return t.uuid!=e}),this.content.references=t}},{key:"hasRelationshipWithItem",value:function(e){return null!=this.content.references.find(function(t){return t.uuid==e.uuid})}},{key:"isBeingRemovedLocally",value:function(){}},{key:"didFinishSyncing",value:function(){}},{key:"informReferencesOfUUIDChange",value:function(e,t){}},{key:"potentialItemOfInterestHasChangedItsUUID",value:function(e,t,r){if(!this.errorDecrypting){var n=!0,i=!1,a=void 0;try{for(var o,s=this.content.references[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;u.uuid==t&&(u.uuid=r,this.setDirty(!0))}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"doNotEncrypt",value:function(){return!1}},{key:"setDomainDataItem",value:function(e,t,r){if(!r)return void console.error("SFItem.AppDomain needs to be set.");if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var n=this.content.appData[r];n||(n={}),n[e]=t,this.content.appData[r]=n}}},{key:"getDomainDataItem",value:function(e,t){if(!t)return void console.error("SFItem.AppDomain needs to be set.");if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var r=this.content.appData[t];return r?r[e]:null}}},{key:"setAppDataItem",value:function(t,r){this.setDomainDataItem(t,r,e.AppDomain)}},{key:"getAppDataItem",value:function(t){return this.getDomainDataItem(t,e.AppDomain)}},{key:"hasRawClientUpdatedAtValue",value:function(){return null!=this.getAppDataItem("client_updated_at")}},{key:"keysToIgnoreWhenCheckingContentEquality",value:function(){return[]}},{key:"appDataKeysToIgnoreWhenCheckingContentEquality",value:function(){return["client_updated_at"]}},{key:"getContentCopy",value:function(){return JSON.parse(JSON.stringify(this.content))}},{key:"isItemContentEqualWith",value:function(t){return e.AreItemContentsEqual({leftContent:this.content,rightContent:t.content,keysToIgnore:this.keysToIgnoreWhenCheckingContentEquality(),appDataKeysToIgnore:this.appDataKeysToIgnoreWhenCheckingContentEquality()})}},{key:"satisfiesPredicate",value:function(e){return B.ItemSatisfiesPredicate(this,e)}},{key:"createdAtString",value:function(){return this.dateToLocalizedString(this.created_at)}},{key:"updatedAtString",value:function(){return this.dateToLocalizedString(this.client_updated_at)}},{key:"updatedAtTimestamp",value:function(){return this.updated_at.getTime()}},{key:"dateToLocalizedString",value:function(e){if("undefined"!=typeof Intl&&Intl.DateTimeFormat){if(!M){var t=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;M=new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})}return M.format(e)}return e.toDateString()+" "+e.toLocaleTimeString()}},{key:"contentObject",get:function(){if(this.errorDecrypting)return this.content;if(!this.content)return this.content={},this.content;if(null!==this.content&&"object"===f(this.content))return this.content;try{var e=JSON.parse(this.content);return this.content=e,this.content}catch(e){return console.log("Error parsing json",e,this),this.content={},this.content}}},{key:"pinned",get:function(){return this.getAppDataItem("pinned")}},{key:"archived",get:function(){return this.getAppDataItem("archived")}},{key:"locked",get:function(){return this.getAppDataItem("locked")}},{key:"displayName",get:function(){return"Item"}},{key:"client_updated_at",get:function(){if(!this._client_updated_at){var e=this.getAppDataItem("client_updated_at");this._client_updated_at=e?new Date(e):new Date(this.updated_at)}return this._client_updated_at},set:function(e){this._client_updated_at=e,this.setAppDataItem("client_updated_at",e)}}],[{key:"deepMerge",value:function(e,t){function r(e,t){if(_.isArray(e))return t}return _.mergeWith(e,t,r),e}},{key:"AreItemContentsEqual",value:function(t){var r=t.leftContent,n=t.rightContent,i=t.keysToIgnore,a=t.appDataKeysToIgnore,o=function(e,t){if(!e)return e;var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){delete e[a.value]}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e};return r=JSON.parse(JSON.stringify(r)),r.appData&&o(r.appData[e.AppDomain],a),r=o(r,i),n=JSON.parse(JSON.stringify(n)),n.appData&&o(n.appData[e.AppDomain],a),n=o(n,i),JSON.stringify(r)===JSON.stringify(n)}}]),e}();n.SFItem=F;var O=function(){function e(t,r,n){if(d(this,e),this.item=t,this.keys=r,this.auth_params=n,this.keys&&!this.auth_params)throw"SFItemParams.auth_params must be supplied if supplying keys.";if(this.auth_params&&!this.auth_params.version)throw"SFItemParams.auth_params is missing version"}return v(e,[{key:"paramsForExportFile",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.forExportFile=!0,!t){e.next=5;break}return e.abrupt("return",this.__params());case 5:return e.next=7,this.__params();case 7:return r=e.sent,e.abrupt("return",_.omit(r,["deleted"]));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"paramsForExtension",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.paramsForExportFile());case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"paramsForLocalStorage",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.additionalFields=["dirty","dirtiedDate","errorDecrypting"],this.forExportFile=!0,e.abrupt("return",this.__params());case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"paramsForSync",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.__params());case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"__params",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={uuid:this.item.uuid,content_type:this.item.content_type,deleted:this.item.deleted,created_at:this.item.created_at,updated_at:this.item.updated_at},this.item.errorDecrypting){e.next=23;break}if(r=this.item.doNotEncrypt()&&!this.forExportFile,!this.keys||r){e.next=11;break}return e.next=6,SFJS.itemTransformer.encryptItem(this.item,this.keys,this.auth_params);case 6:n=e.sent,_.merge(t,n),"001"!==this.auth_params.version&&(t.auth_hash=null),e.next=21;break;case 11:if(!this.forExportFile){e.next=15;break}e.t0=this.item.createContentJSONFromProperties(),e.next=19;break;case 15:return e.next=17,SFJS.crypto.base64(JSON.stringify(this.item.createContentJSONFromProperties()));case 17:e.t1=e.sent,e.t0="000"+e.t1;case 19:t.content=e.t0,this.forExportFile||(t.enc_item_key=null,t.auth_hash=null);case 21:e.next=26;break;case 23:t.content=this.item.content,t.enc_item_key=this.item.enc_item_key,t.auth_hash=this.item.auth_hash;case 26:return this.additionalFields&&_.merge(t,_.pick(this.item,this.additionalFields)),e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this)}));return e}()}]),e}();n.SFItemParams=O;var B=function(){function e(t,r,n){d(this,e),this.keypath=t,this.operator=r,this.value=n,e.IsRecursiveOperator(this.operator)&&(this.value=this.value.map(e.fromArray))}return v(e,null,[{key:"fromArray",value:function(t){return new e(t[0],t[1],t[2])}},{key:"ObjectSatisfiesPredicate",value:function(t,r){if(Array.isArray(r)&&(r=this.fromArray(r)),e.IsRecursiveOperator(r.operator)){if("and"===r.operator){var n=!0,i=!1,a=void 0;try{for(var o,s=r.value[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(!this.ObjectSatisfiesPredicate(t,u))return!1}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return!0}if("or"===r.operator){var c=!0,l=!1,f=void 0;try{for(var h,p=r.value[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var u=h.value;if(this.ObjectSatisfiesPredicate(t,u))return!0}}catch(e){l=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(l)throw f}}return!1}}var d=r.value;"string"==typeof d&&d.includes(".ago")&&(d=this.DateFromString(d));var y=r.keypath.split(".").reduce(function(e,t){return e&&e[t]},t),v=[!1,"",null,void 0,NaN];if(void 0==y)return"!="==r.operator?!v.includes(r.value):v.includes(r.value);if("="==r.operator)return Array.isArray(y)?JSON.stringify(y)==JSON.stringify(d):y==d;if("!="==r.operator)return Array.isArray(y)?JSON.stringify(y)!=JSON.stringify(d):y!==d;if("<"==r.operator)return y<d;if(">"==r.operator)return y>d;if("<="==r.operator)return y<=d;if(">="==r.operator)return y>=d;if("startsWith"==r.operator)return y.startsWith(d);if("in"==r.operator)return-1!=d.indexOf(y);if("includes"==r.operator)return this.resolveIncludesPredicate(y,d);if("matches"==r.operator){return new RegExp(d).test(y)}return!1}},{key:"resolveIncludesPredicate",value:function(t,r){if("string"==typeof r)return t.includes(r);var n;n=Array.isArray(r)?e.fromArray(r):r;var i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;if(this.ObjectSatisfiesPredicate(c,n))return!0}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return!1}},{key:"ItemSatisfiesPredicate",value:function(t,r){return Array.isArray(r)&&(r=e.fromArray(r)),this.ObjectSatisfiesPredicate(t,r)}},{key:"ItemSatisfiesPredicates",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(!this.ItemSatisfiesPredicate(e,s))return!1}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return!0}},{key:"DateFromString",value:function(e){var t=e.split("."),r=t[1],n=new Date,i=parseInt(t[0]);return"days"==r?n.setDate(n.getDate()-i):"hours"==r&&n.setHours(n.getHours()-i),n}},{key:"IsRecursiveOperator",value:function(e){return["and","or"].includes(e)}}]),e}();n.SFPredicate=B;var P=function(e){function r(e){var n;return d(this,r),n=t(this,i(r).call(this,e)),n.content.desktopPrivileges||(n.content.desktopPrivileges={}),n}return a(r,e),v(r,null,[{key:"contentType",value:function(){return"SN|Privileges"}}]),v(r,[{key:"setCredentialsForAction",value:function(e,t){this.content.desktopPrivileges[e]=t}},{key:"getCredentialsForAction",value:function(e){return this.content.desktopPrivileges[e]||[]}},{key:"toggleCredentialForAction",value:function(e,t){this.isCredentialRequiredForAction(e,t)?this.removeCredentialForAction(e,t):this.addCredentialForAction(e,t)}},{key:"removeCredentialForAction",value:function(e,t){_.pull(this.content.desktopPrivileges[e],t)}},{key:"addCredentialForAction",value:function(e,t){var r=this.getCredentialsForAction(e);r.push(t),this.setCredentialsForAction(e,r)}},{key:"isCredentialRequiredForAction",value:function(e,t){return this.getCredentialsForAction(e).includes(t)}}]),r}(F);n.SFPrivileges=P;var E=function(e){function r(e){var n;return d(this,r),n=t(this,i(r).call(this,e)),n.content.itemUUIDToItemHistoryMapping||(n.content.itemUUIDToItemHistoryMapping={}),Object.keys(n.content.itemUUIDToItemHistoryMapping).forEach(function(e){var t=n.content.itemUUIDToItemHistoryMapping[e];n.content.itemUUIDToItemHistoryMapping[e]=new T(t)}),n}return a(r,e),v(r,[{key:"addEntryForItem",value:function(e){return this.historyForItem(e).addHistoryEntryForItem(e)}},{key:"historyForItem",value:function(e){var t=this.content.itemUUIDToItemHistoryMapping[e.uuid];return t||(t=this.content.itemUUIDToItemHistoryMapping[e.uuid]=new T),t}},{key:"clearItemHistory",value:function(e){this.historyForItem(e).clear()}},{key:"clearAllHistory",value:function(){this.content.itemUUIDToItemHistoryMapping={}}},{key:"optimizeHistoryForItem",value:function(e){var t=this.historyForItem(e);t.entries.length>r.LargeItemEntryAmountThreshold&&t.optimize()}}]),r}(F);n.SFHistorySession=E,E.LargeItemEntryAmountThreshold=60;var T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(d(this,e),this.entries||(this.entries=[]),t.entries){var r=!0,n=!1,i=void 0;try{for(var a,o=t.entries[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=this.createEntryForItem(s.item);u.setPreviousEntry(this.getLastEntry()),this.entries.push(u)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}}return v(e,[{key:"createEntryForItem",value:function(t){var r=e.HistoryEntryClassMapping&&e.HistoryEntryClassMapping[t.content_type];return r||(r=j),new r(t)}},{key:"getLastEntry",value:function(){return this.entries[this.entries.length-1]}},{key:"addHistoryEntryForItem",value:function(e){var t=this.createEntryForItem(e),r=this.getLastEntry();if(t.setPreviousEntry(r),!t.isSameAsEntry(r))return this.entries.push(t),t}},{key:"clear",value:function(){this.entries.length=0}},{key:"optimize",value:function(){var t=this,r=[],n=function(t){return t.deltaSize()>e.LargeEntryDeltaThreshold},i=function(e,i,a){if(a)r.push(e);else{var i=r.indexOf(e);-1!==i&&r.splice(i,1)}if(a&&n(e)&&-1==e.operationVector()){var o=t.entries[i-1];o&&r.push(o)}};this.entries.forEach(function(e,r){if(0==r||r==t.entries.length-1)i(e,r,!0);else{var a=n(e);i(e,r,a)}}),this.entries=this.entries.filter(function(e,t){return-1!==r.indexOf(e)})}}]),e}();n.SFItemHistory=T,T.LargeEntryDeltaThreshold=15;var j=function(){function e(t){d(this,e),this.item=F.deepMerge({},t),this.defaultContentKeyToDiffOn="text",this.textCharDiffLength=0,"string"==typeof this.item.updated_at&&(this.item.updated_at=new Date(this.item.updated_at))}return v(e,[{key:"setPreviousEntry",value:function(e){this.hasPreviousEntry=null!=e,this.item.content[this.defaultContentKeyToDiffOn]&&(this.textCharDiffLength=e?this.item.content[this.defaultContentKeyToDiffOn].length-e.item.content[this.defaultContentKeyToDiffOn].length:this.item.content[this.defaultContentKeyToDiffOn].length)}},{key:"operationVector",value:function(){return void 0!=this.textCharDiffLength?this.hasPreviousEntry&&0!=this.textCharDiffLength?this.textCharDiffLength<0?-1:1:0:1}},{key:"deltaSize",value:function(){return void 0!=this.textCharDiffLength?Math.abs(this.textCharDiffLength):1}},{key:"isSameAsEntry",value:function(e){if(!e)return!1;var t=new F(this.item),r=new F(e.item);return t.isItemContentEqualWith(r)}}]),e}();n.SFItemHistoryEntry=j;var b="undefined"!=typeof window?window:void 0!==e?e:null,L=function(){function e(){d(this,e),this.DefaultPBKDF2Length=768}return v(e,[{key:"generateUUIDSync",value:function(){var e=b.crypto||b.msCrypto;if(e){var t=new Uint32Array(4);e.getRandomValues(t);var r=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){r++;var n=t[r>>3]>>r%8*4&15;return("x"==e?n:3&n|8).toString(16)})}var n=(new Date).getTime();return b.performance&&"function"==typeof b.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})}},{key:"generateUUID",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.generateUUIDSync());case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"timingSafeEqual",value:function(e,t){var r=String(e),n=String(t),i=r.length,a=0;i!==n.length&&(n=r,a=1);for(var o=0;o<i;o++)a|=r.charCodeAt(o)^n.charCodeAt(o);return 0===a}},{key:"decryptText",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i,a,o,s,u,c,l,f,h,p=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.length>0&&void 0!==p[0]?p[0]:{},r=t.ciphertextToAuth,n=t.contentCiphertext,i=t.encryptionKey,a=t.iv,o=t.authHash,s=t.authKey,!(u=p.length>1?p[1]:void 0)||o){e.next=5;break}return console.error("Auth hash is required."),e.abrupt("return");case 5:if(!o){e.next=12;break}return e.next=8,this.hmac256(r,s);case 8:if(c=e.sent,!1!==this.timingSafeEqual(o,c)){e.next=12;break}return console.error("Auth hash does not match, returning null."),e.abrupt("return",null);case 12:return l=g.enc.Hex.parse(i),f=g.enc.Hex.parse(a||""),h=g.AES.decrypt(n,l,{iv:f,mode:g.mode.CBC,padding:g.pad.Pkcs7}),e.abrupt("return",h.toString(g.enc.Utf8));case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"encryptText",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){var i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=g.enc.Hex.parse(r),a=g.enc.Hex.parse(n||""),o=g.AES.encrypt(t,i,{iv:a,mode:g.mode.CBC,padding:g.pad.Pkcs7}),e.abrupt("return",o.toString());case 4:case"end":return e.stop()}},e)}));return e}()},{key:"generateRandomKey",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.lib.WordArray.random(t/8).toString());case 1:case"end":return e.stop()}},e)}));return e}()},{key:"generateItemEncryptionKey",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=512,r=1,e.next=4,this.generateRandomKey(t);case 4:return n=e.sent,e.next=7,this.generateRandomKey(t);case 7:return i=e.sent,e.abrupt("return",this.pbkdf2(i,n,r,t));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"firstHalfOfKey",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(0,t.length/2));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"secondHalfOfKey",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(t.length/2,t.length));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"base64",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b.btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"base64Decode",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b.atob(t));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"sha256",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.SHA256(t).toString());case 1:case"end":return e.stop()}},e)}));return e}()},{key:"hmac256",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.enc.Hex.parse(r),i=g.enc.Utf8.parse(t),a=g.HmacSHA256(i,n).toString(),e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return e}()},{key:"generateSalt",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sha256([t,"SF",r,n,i].join(":"));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"generateSymmetricKeyPair",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i,a,o,s,u,c,l,f=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},r=t.password,n=t.pw_salt,i=t.pw_cost,e.next=3,this.pbkdf2(r,n,i,this.DefaultPBKDF2Length);case 3:return a=e.sent,o=a.length,s=o/3,u=a.slice(0,s),c=a.slice(s,2*s),l=a.slice(2*s,3*s),e.abrupt("return",[u,c,l]);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"computeEncryptionKeysForUser",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("003"!=r.version){e.next=9;break}if(r.identifier){e.next=4;break}return console.error("authParams is missing identifier."),e.abrupt("return");case 4:return e.next=6,this.generateSalt(r.identifier,r.version,r.pw_cost,r.pw_nonce);case 6:n=e.sent,e.next=10;break;case 9:n=r.pw_salt;case 10:return e.abrupt("return",this.generateSymmetricKeyPair({password:t,pw_salt:n,pw_cost:r.pw_cost}).then(function(e){return{pw:e[0],mk:e[1],ak:e[2]}}));case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"generateInitialKeysAndAuthParamsForUser",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.SFJS.version,i=this.SFJS.defaultPasswordGenerationCost,e.next=4,this.generateRandomKey(256);case 4:return a=e.sent,e.next=7,this.generateSalt(t,n,i,a);case 7:return o=e.sent,e.abrupt("return",this.generateSymmetricKeyPair({password:r,pw_salt:o,pw_cost:i}).then(function(e){var r={pw_nonce:a,pw_cost:i,identifier:t,version:n};return{keys:{pw:e[0],mk:e[1],ak:e[2]},authParams:r}}));case 9:case"end":return e.stop()}},e,this)}));return e}()}]),e}();n.SFAbstractCrypto=L;var H=function(e){function r(){return d(this,r),t(this,i(r).apply(this,arguments))}return a(r,e),v(r,[{key:"pbkdf2",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={keySize:i/32,hasher:g.algo.SHA512,iterations:n},e.abrupt("return",g.PBKDF2(t,r,a).toString());case 2:case"end":return e.stop()}},e)}));return e}()}]),r}(L);n.SFCryptoJS=H;var b="undefined"!=typeof window?window:void 0!==e?e:null,U=b.crypto?b.crypto.subtle:null,N=function(e){function r(){return d(this,r),t(this,i(r).apply(this,arguments))}return a(r,e),v(r,[{key:"pbkdf2",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webCryptoImportKey(t,"PBKDF2",["deriveBits"]);case 2:if(a=e.sent){e.next=6;break}return console.log("Key is null, unable to continue"),e.abrupt("return",null);case 6:return e.abrupt("return",this.webCryptoDeriveBits(a,r,n,i));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"generateRandomKey",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=!0,e.abrupt("return",U.generateKey({name:"AES-CBC",length:t},r,["encrypt","decrypt"]).then(function(e){return U.exportKey("raw",e).then(function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.arrayBufferToHexString(new Uint8Array(t));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("Error exporting key",e)})}).catch(function(e){console.error("Error generating key",e)}));case 2:case"end":return e.stop()}},e)}));return e}()},{key:"generateItemEncryptionKey",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=256,e.abrupt("return",Promise.all([this.generateRandomKey(t),this.generateRandomKey(t)]).then(function(e){return e.join("")}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"encryptText",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){var i,a,o,s,u,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return e.next=3,this.hexStringToArrayBuffer(n);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=new ArrayBuffer(16);case 7:return i=e.t0,a={name:"AES-CBC",iv:i},e.next=11,this.hexStringToArrayBuffer(r);case 11:return o=e.sent,e.next=14,this.webCryptoImportKey(o,a.name,["encrypt"]);case 14:return s=e.sent,e.next=17,this.stringToArrayBuffer(t);case 17:return u=e.sent,e.abrupt("return",crypto.subtle.encrypt(a,s,u).then(function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.arrayBufferToBase64(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"decryptText",value:function(){function e(){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(){var t,r,n,i,a,o,s,u,c,l,f,h,d,y,v=this,g=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.length>0&&void 0!==g[0]?g[0]:{},r=t.ciphertextToAuth,n=t.contentCiphertext,i=t.encryptionKey,a=t.iv,o=t.authHash,s=t.authKey,!(u=g.length>1?g[1]:void 0)||o){e.next=5;break}return console.error("Auth hash is required."),e.abrupt("return");case 5:if(!o){e.next=12;break}return e.next=8,this.hmac256(r,s);case 8:if(c=e.sent,!1!==this.timingSafeEqual(o,c)){e.next=12;break}return console.error("Auth hash does not match, returning null. ".concat(o," != ").concat(c)),e.abrupt("return",null);case 12:if(!a){e.next=18;break}return e.next=15,this.hexStringToArrayBuffer(a);case 15:e.t0=e.sent,e.next=19;break;case 18:e.t0=new ArrayBuffer(16);case 19:return l=e.t0,f={name:"AES-CBC",iv:l},e.next=23,this.hexStringToArrayBuffer(i);case 23:return h=e.sent,e.next=26,this.webCryptoImportKey(h,f.name,["decrypt"]);case 26:return d=e.sent,e.next=29,this.base64ToArrayBuffer(n);case 29:return y=e.sent,e.abrupt("return",crypto.subtle.decrypt(f,d,y).then(function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.arrayBufferToString(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("Error decrypting:",e)}));case 31:case"end":return e.stop()}},e,this)}));return e}()},{key:"hmac256",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n,i,a,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hexStringToArrayBuffer(r);case 2:return n=e.sent,e.next=5,this.webCryptoImportKey(n,"HMAC",["sign"],{name:"SHA-256"});case 5:return i=e.sent,e.next=8,this.stringToArrayBuffer(t);case 8:return a=e.sent,e.abrupt("return",crypto.subtle.sign({name:"HMAC"},i,a).then(function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.arrayBufferToHexString(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("Error computing hmac",e)}));case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"webCryptoImportKey",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=6;break}return e.next=3,this.stringToArrayBuffer(t);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=t;case 7:return a=e.t0,e.abrupt("return",U.importKey("raw",a,{name:r,hash:i},!1,n).then(function(e){return e}).catch(function(e){return console.error(e),null}));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"webCryptoDeriveBits",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i){var a,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stringToArrayBuffer(r);case 2:return e.t0=e.sent,e.t1=n,e.t2={name:"SHA-512"},a={name:"PBKDF2",salt:e.t0,iterations:e.t1,hash:e.t2},e.abrupt("return",U.deriveBits(a,t,i).then(function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.arrayBufferToHexString(new Uint8Array(t));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return console.error(e),null}));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"stringToArrayBuffer",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var n=new Blob([t]),i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(n)}));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"arrayBufferToString",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var n=new Blob([t]),i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsText(n)}));case 1:case"end":return e.stop()}},e)}));return e}()},{key:"arrayBufferToHexString",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=new Uint8Array(t),n="",a=0;a<r.byteLength;a++)i=r[a].toString(16),i.length<2&&(i="0"+i),n+=i;return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return e}()},{key:"hexStringToArrayBuffer",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],n=0;n<t.length;n+=2)r.push(parseInt(t.substr(n,2),16));return e.abrupt("return",new Uint8Array(r));case 2:case"end":return e.stop()}},e)}));return e}()},{key:"base64ToArrayBuffer",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){var r,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.base64Decode(t);case 2:for(r=e.sent,n=r.length,i=new Uint8Array(n),a=0;a<n;a++)i[a]=r.charCodeAt(a);return e.abrupt("return",i.buffer);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"arrayBufferToBase64",value:function(){function e(e){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var n=new Blob([t],{type:"application/octet-binary"}),i=new FileReader;i.onload=function(t){var r=t.target.result;e(r.substr(r.indexOf(",")+1))},i.readAsDataURL(n)}));case 1:case"end":return e.stop()}},e)}));return e}()}]),r}(L);n.SFCryptoWeb=N;var z=function(){function e(t){d(this,e),this.crypto=t}return v(e,[{key:"_private_encryptString",value:function(){function e(e,r,n,i,a){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n,i,a){var o,s,u,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("001"!==a.version){e.next=7;break}return e.next=3,this.crypto.encryptText(t,r,null);case 3:s=e.sent,o=a.version+s,e.next=21;break;case 7:return e.next=9,this.crypto.generateRandomKey(128);case 9:return u=e.sent,e.next=12,this.crypto.encryptText(t,r,u);case 12:return s=e.sent,c=[a.version,i,u,s].join(":"),e.next=16,this.crypto.hmac256(c,n);case 16:return l=e.sent,e.next=19,this.crypto.base64(JSON.stringify(a));case 19:f=e.sent,o=[a.version,l,i,u,s,f].join(":");case 21:return e.abrupt("return",o);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"encryptItem",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){var i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={},e.next=3,this.crypto.generateItemEncryptionKey();case 3:if(a=e.sent,"001"!==n.version){e.next=10;break}return e.next=7,this.crypto.encryptText(a,r.mk,null);case 7:i.enc_item_key=e.sent,e.next=13;break;case 10:return e.next=12,this._private_encryptString(a,r.mk,r.ak,t.uuid,n);case 12:i.enc_item_key=e.sent;case 13:return e.next=15,this.crypto.firstHalfOfKey(a);case 15:return o=e.sent,e.next=18,this.crypto.secondHalfOfKey(a);case 18:return s=e.sent,e.next=21,this._private_encryptString(JSON.stringify(t.createContentJSONFromProperties()),o,s,t.uuid,n);case 21:if(u=e.sent,"001"!==n.version){e.next=27;break}return e.next=25,this.crypto.hmac256(u,s);case 25:c=e.sent,i.auth_hash=c;case 27:return i.content=u,e.abrupt("return",i);case 29:case"end":return e.stop()}},e,this)}));return e}()},{key:"encryptionComponentsFromString",value:function(e,t,r){var n=e.substring(0,3);if("001"===n)return{contentCiphertext:e.substring(3,e.length),encryptionVersion:n,ciphertextToAuth:e,iv:null,authHash:null,encryptionKey:t,authKey:r};var i=e.split(":");return{encryptionVersion:i[0],authHash:i[1],uuid:i[2],iv:i[3],contentCiphertext:i[4],authParams:i[5],ciphertextToAuth:[i[0],i[2],i[3],i[4]].join(":"),encryptionKey:t,authKey:r}}},{key:"decryptItem",value:function(){function e(e,r){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r){var n,i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t.content){e.next=2;break}return e.abrupt("return");case 2:if(!t.content.startsWith("000")){e.next=14;break}return e.prev=3,e.t0=JSON,e.next=7,this.crypto.base64Decode(t.content.substring(3,t.content.length));case 7:e.t1=e.sent,t.content=e.t0.parse.call(e.t0,e.t1),e.next=13;break;case 11:e.prev=11,e.t2=e.catch(3);case 13:return e.abrupt("return");case 14:if(t.enc_item_key){e.next=17;break}return console.log("Missing item encryption key, skipping decryption."),e.abrupt("return");case 17:if(n=t.enc_item_key,i=!0,n.startsWith("002")||n.startsWith("003")||(n="001"+n,i=!1),a=this.encryptionComponentsFromString(n,r.mk,r.ak),!a.uuid||a.uuid===t.uuid){e.next=26;break}return console.error("Item key params UUID does not match item UUID"),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 26:return e.next=28,this.crypto.decryptText(a,i);case 28:if(o=e.sent){e.next=34;break}return console.log("Error decrypting item",t),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 34:return e.next=36,this.crypto.firstHalfOfKey(o);case 36:return s=e.sent,e.next=39,this.crypto.secondHalfOfKey(o);case 39:return u=e.sent,c=this.encryptionComponentsFromString(t.content,s,u),e.prev=41,e.t3=JSON,e.next=45,this.crypto.base64Decode(c.authParams);case 45:e.t4=e.sent,t.auth_params=e.t3.parse.call(e.t3,e.t4),e.next=51;break;case 49:e.prev=49,e.t5=e.catch(41);case 51:if(!c.uuid||c.uuid===t.uuid){e.next=55;break}return t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 55:return c.authHash||(c.authHash=t.auth_hash),e.next=58,this.crypto.decryptText(c,!0);case 58:l=e.sent,l?(1==t.errorDecrypting&&(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!1,t.content=l):(t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0);case 60:case"end":return e.stop()}},e,this,[[3,11],[41,49]])}));return e}()},{key:"decryptMultipleItems",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=p(regeneratorRuntime.mark(function e(t,r,n){var i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(){var e=p(regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(1!=t.deleted||null!=t.content){e.next=4;break}return e.abrupt("return");case 4:if(!(i="string"==typeof t.content||t.content instanceof String)){e.next=19;break}return e.prev=6,e.next=9,a.decryptItem(t,r);case 9:e.next=19;break;case 11:if(e.prev=11,e.t0=e.catch(6),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,!n){e.next=17;break}throw e.t0;case 17:return console.error("Error decrypting item",t,e.t0),e.abrupt("return");case 19:case"end":return e.stop()}},e,null,[[6,11]])}));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",Promise.all(t.map(function(e){return i(e)})));case 2:case"end":return e.stop()}},e)}));return e}()}]),e}();n.SFItemTransformer=z;var b="undefined"!=typeof window?window:void 0!==e?e:null,K=function(){function e(t){if(d(this,e),b){!("undefined"!=typeof document&&document.documentMode||/Edge/.test(navigator.userAgent))&&b.crypto&&b.crypto.subtle?this.crypto=new N:this.crypto=new H}t&&(this.crypto=t),this.itemTransformer=new z(this.crypto),this.crypto.SFJS={version:this.version(),defaultPasswordGenerationCost:this.defaultPasswordGenerationCost()}}return v(e,[{key:"version",value:function(){return"003"}},{key:"supportsPasswordDerivationCost",value:function(e){return!(e>5e3)||this.crypto instanceof N}},{key:"supportedVersions",value:function(){return["001","002","003"]}},{key:"isVersionNewerThanLibraryVersion",value:function(e){var t=this.version();return parseInt(e)>parseInt(t)}},{key:"isProtocolVersionOutdated",value:function(e){var t={"001":Date.parse("2018-01-01"),"002":Date.parse("2020-01-01")},r=t[e];return!!r&&new Date>r}},{key:"costMinimumForVersion",value:function(e){return{"001":3e3,"002":3e3,"003":11e4}[e]}},{key:"defaultPasswordGenerationCost",value:function(){return this.costMinimumForVersion(this.version())}}]),e}();if(n.StandardFile=K,b)try{b.StandardFile=K,b.SFJS=new K,b.SFCryptoWeb=N,b.SFCryptoJS=H,b.SFItemTransformer=z,b.SFModelManager=S,b.SFItem=F,b.SFItemParams=O,b.SFHttpManager=w,b.SFStorageManager=A,b.SFSyncManager=C,b.SFAuthManager=k,b.SFMigrationManager=x,b.SFAlertManager=m,b.SFPredicate=B,b.SFHistorySession=E,b.SFSessionHistoryManager=R,b.SFItemHistory=T,b.SFItemHistoryEntry=j,b.SFPrivilegesManager=I,b.SFPrivileges=P,b.SFSingletonManager=D}catch(e){console.log("Exception while exporting window variables",e)}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}).call(t,r(3))},function(e,t){!function(t){"use strict";function r(e,t,r,n){var a=t&&t.prototype instanceof i?t:i,o=Object.create(a.prototype),s=new p(n||[]);return o._invoke=c(e,r,s),o}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function i(){}function a(){}function o(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function u(e){function t(r,i,a,o){var s=n(e[r],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&m.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(c).then(function(e){u.value=e,a(u)},o)}o(s.arg)}function r(e,r){function n(){return new Promise(function(n,i){t(e,r,n,i)})}return i=i?i.then(n,n):n()}var i;this._invoke=r}function c(e,t,r){var i=I;return function(a,o){if(i===D)throw new Error("Generator is already running");if(i===A){if("throw"===a)throw o;return y()}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var u=l(s,r);if(u){if(u===C)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===I)throw i=A,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=D;var c=n(e,t,r);if("normal"===c.type){if(i=r.done?A:R,c.arg===C)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=A,r.method="throw",r.arg=c.arg)}}}function l(e,t){var r=e.iterator[t.method];if(r===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,l(e,t),"throw"===t.method))return C;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}var i=n(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,C;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,C):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,C)}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function d(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(m.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=v,t.done=!0,t};return n.next=n}}return{next:y}}function y(){return{value:v,done:!0}}var v,g=Object.prototype,m=g.hasOwnProperty,k="function"==typeof Symbol?Symbol:{},b=k.iterator||"@@iterator",w=k.asyncIterator||"@@asyncIterator",x=k.toStringTag||"@@toStringTag",S="object"==typeof e,_=t.regeneratorRuntime;if(_)return void(S&&(e.exports=_));_=t.regeneratorRuntime=S?e.exports:{},_.wrap=r;var I="suspendedStart",R="suspendedYield",D="executing",A="completed",C={},M={};M[b]=function(){return this};var F=Object.getPrototypeOf,O=F&&F(F(d([])));O&&O!==g&&m.call(O,b)&&(M=O);var B=o.prototype=i.prototype=Object.create(M);a.prototype=B.constructor=o,o.constructor=a,o[x]=a.displayName="GeneratorFunction",_.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===a||"GeneratorFunction"===(t.displayName||t.name))},_.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(B),e},_.awrap=function(e){return{__await:e}},s(u.prototype),u.prototype[w]=function(){return this},_.AsyncIterator=u,_.async=function(e,t,n,i){var a=new u(r(e,t,n,i));return _.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},s(B),B[x]="Generator",B[b]=function(){return this},B.toString=function(){return"[object Generator]"},_.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},_.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var o=m.call(i,"catchLoc"),s=m.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&m.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,C):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),C},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),C}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;h(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=v),C}}}(function(){return this}()||Function("return this")())},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",function(){return l});var s=r(1),u=(r.n(s),r(5)),c=(r.n(u),r(0)),l=(r.n(c),function(){function e(t){n(this,e),this.componentManager=t,this.updateObservers=[],this.items=[]}return a(e,[{key:"getPlatform",value:function(){return this.componentManager.platform}},{key:"getEnvironment",value:function(){return this.componentManager.environment}},{key:"isMobile",value:function(){return"mobile"==this.getEnvironment()}},{key:"addEventHandler",value:function(e){var t={id:Math.random,callback:e};return this.updateObservers.push(t),t}},{key:"removeUpdateObserver",value:function(e){this.updateObservers.splice(this.updateObservers.indexOf(e),1)}},{key:"notifyObserversOfEvent",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.updateObservers[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.callback(e)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"filterItems",value:function(e){return this.items.filter(function(t){return t.content_type==e})}},{key:"getFileDescriptors",value:function(){return this.filterItems(e.FileDescriptorContentTypeKey)}},{key:"beginStreamingFiles",value:function(){var t=this,r=[e.FileDescriptorContentTypeKey,e.FileSafeCredentialsContentType,e.FileSafeIntegrationContentTypeKey];this.componentManager.streamItems(r,function(e){t.handleStreamItemsMessage(e)})}},{key:"handleStreamItemsMessage",value:function(t){var r,n,i,a,o,s,u;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:r=!0,n=!1,i=void 0,l.prev=3,a=t[Symbol.iterator]();case 5:if(r=(o=a.next()).done){l.next=18;break}if(s=o.value,s=new c.SFItem(s),!s.deleted){l.next=11;break}return this.removeItemFromItems(s),l.abrupt("continue",15);case 11:if(!s.isMetadataUpdate){l.next=13;break}return l.abrupt("continue",15);case 13:u=this.indexOfItem(s),u>=0?this.items[u]=s:this.items.push(s);case 15:r=!0,l.next=5;break;case 18:l.next=24;break;case 20:l.prev=20,l.t0=l.catch(3),n=!0,i=l.t0;case 24:l.prev=24,l.prev=25,r||null==a.return||a.return();case 27:if(l.prev=27,!n){l.next=30;break}throw i;case 30:return l.finish(27);case 31:return l.finish(24);case 32:this.notifyObserversOfEvent(e.BridgeEventReceivedItems);case 33:case"end":return l.stop()}},null,this,[[3,20,24,32],[25,,27,31]])}},{key:"indexOfItem",value:function(e){for(var t in this.items)if(this.items[t].uuid==e.uuid)return t;return-1}},{key:"removeItemFromItems",value:function(e){this.items=this.items.filter(function(t){return t.uuid!==e.uuid})}},{key:"createItem",value:function(e,t){this.createItems([e],t)}},{key:"createItems",value:function(e,t){this.componentManager.createItems(e,function(e){t&&t(e.map(function(e){return new c.SFItem(e)}))})}},{key:"saveItem",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.saveItems([e]));case 1:case"end":return t.stop()}},null,this)}},{key:"saveItems",value:function(t){var r=this;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(n,i){r.componentManager.saveItems(t,function(t){n(t),r.notifyObserversOfEvent(e.BridgeEventSavedItem)})}));case 1:case"end":return n.stop()}})}},{key:"indexOfItem",value:function(e){for(var t in this.items)if(this.items[t].uuid==e.uuid)return t;return-1}},{key:"deleteItem",value:function(e,t){this.deleteItems([e],t)}},{key:"deleteItems",value:function(e,t){this.componentManager.deleteItems(e,t)}},{key:"removeItemFromItems",value:function(e){this.items=this.items.filter(function(t){return t.uuid!==e.uuid})}}]),e}());o(l,"FileItemContentTypeKey","SN|FileSafe|File"),o(l,"FileSafeCredentialsContentType","SN|FileSafe|Credentials"),o(l,"FileDescriptorContentTypeKey","SN|FileSafe|FileMetadata"),o(l,"FileSafeIntegrationContentTypeKey","SN|FileSafe|Integration"),o(l,"BridgeEventLoadedCredentials","BridgeEventLoadedCredentials"),o(l,"BridgeEventReceivedItems","BridgeEventReceivedItems"),o(l,"BridgeEventSavedItem","BridgeEventSavedItem")},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"default",function(){return p});var o=r(2),s=r(7),u=r(8),c=r(9),l=r(10),f=r(12),h=r(0),p=(r.n(h),function(){function e(t){var r=this,i=t.componentManager;n(this,e),this.dataChangeObservers=[],this.newFileDescriptorHandlers=[],this.extensionBridge=new o.a(i),this.extensionBridge.addEventHandler(function(e){r.notifyObservers()}),this.relayManager=new s.a,this.integrationManager=new u.a(this.extensionBridge),this.credentialManager=new c.a({extensionBridge:this.extensionBridge,onCredentialLoad:function(){r.relayManager.setCredentials(r.credentialManager.getDefaultCredentials())}}),this.fileManager=new l.a(this.extensionBridge,this.relayManager,this.integrationManager,this.credentialManager),this.extensionBridge.beginStreamingFiles()}return a(e,null,[{key:"getSFItemClass",value:function(){return h.SFItem}}]),a(e,[{key:"addNewFileDescriptorHandler",value:function(e){this.newFileDescriptorHandlers.push(e)}},{key:"notifyObservers",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.dataChangeObservers[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){(0,n.value)()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}},{key:"addDataChangeObserver",value:function(e){return this.dataChangeObservers.push(e),e}},{key:"removeDataChangeObserver",value:function(e){this.dataChangeObservers=this.dataChangeObservers.filter(function(t){return t!=e})}},{key:"setCurrentNote",value:function(e){this.currentNote=e,this.notifyObservers()}},{key:"getAllFileDescriptors",value:function(){return this.fileManager.getAllFileDescriptors()}},{key:"findFileDescriptor",value:function(e){return this.fileManager.findFileDescriptor(e)}},{key:"fileDescriptorsForCurrentNote",value:function(){return this.fileManager.fileDescriptorsForNote(this.currentNote)}},{key:"fileDescriptorsForNote",value:function(e){return this.fileManager.fileDescriptorsForNote(e)}},{key:"fileDescriptorsEncryptedWithCredential",value:function(e){return this.fileManager.fileDescriptorsEncryptedWithCredential(e)}},{key:"deleteFileFromDescriptor",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fileManager.deleteFileFromDescriptor(e));case 1:case"end":return t.stop()}},null,this)}},{key:"uploadFile",value:function(e){var t,r,n,i,a,o,s,u,c,l,f,h;return regeneratorRuntime.async(function(p){for(;;)switch(p.prev=p.next){case 0:return t=e.fileItem,r=e.inputFileName,n=e.fileType,i=e.credential,a=e.note,a||(a=this.currentNote),p.next=4,regeneratorRuntime.awrap(this.fileManager.uploadFile({fileItem:t,inputFileName:r,fileType:n,credential:i,note:a}));case 4:if(!(o=p.sent)){p.next=25;break}for(s=!0,u=!1,c=void 0,p.prev=9,l=this.newFileDescriptorHandlers[Symbol.iterator]();!(s=(f=l.next()).done);s=!0)(h=f.value)(o);p.next=17;break;case 13:p.prev=13,p.t0=p.catch(9),u=!0,c=p.t0;case 17:p.prev=17,p.prev=18,s||null==l.return||l.return();case 20:if(p.prev=20,!u){p.next=23;break}throw c;case 23:return p.finish(20);case 24:return p.finish(17);case 25:return p.abrupt("return",o);case 26:case"end":return p.stop()}},null,this,[[9,13,17,25],[18,,20,24]])}},{key:"encryptAndUploadJavaScriptFileObject",value:function(e){var t=this;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(r,n){var i=new FileReader;i.onload=function(n){var i,a,o,s;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return i=n.target.result,a=i,u.next=4,regeneratorRuntime.awrap(SFJS.crypto.arrayBufferToBase64(a));case 4:return o=u.sent,u.next=7,regeneratorRuntime.awrap(t.encryptAndUploadData({base64Data:o,inputFileName:e.name,fileType:e.type}));case 7:s=u.sent,r(s);case 9:case"end":return u.stop()}})},i.readAsArrayBuffer(e)}));case 1:case"end":return r.stop()}})}},{key:"encryptAndUploadData",value:function(e){var t,r,n,i,a=this;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.base64Data,r=e.inputFileName,n=e.fileType,i=this.getDefaultCredentials(),o.abrupt("return",this.encryptFile({data:t,inputFileName:r,fileType:n,credential:i}).then(function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a.uploadFile({fileItem:e,inputFileName:r,fileType:n,credential:i}).catch(function(e){console.error("filesafe-js | error uploading file:",e)}));case 1:case"end":return t.stop()}})}));case 3:case"end":return o.stop()}},null,this)}},{key:"downloadFileFromDescriptor",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fileManager.downloadFileFromDescriptor(e));case 1:case"end":return t.stop()}},null,this)}},{key:"encryptFile",value:function(e){var t,r,n,i;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.data,r=e.inputFileName,n=e.fileType,i=e.credential,a.abrupt("return",this.fileManager.encryptFile({data:t,inputFileName:r,fileType:n,credential:i}));case 2:case"end":return a.stop()}},null,this)}},{key:"decryptFile",value:function(e){var t,r,n;return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.fileDescriptor,r=e.fileItem,n=e.credential,i.abrupt("return",this.fileManager.decryptFile({fileDescriptor:t,fileItem:r,credential:n}));case 2:case"end":return i.stop()}},null,this)}},{key:"downloadBase64Data",value:function(e){var t=e.base64Data,r=e.fileName,n=e.fileType;f.a.downloadData(f.a.base64toBinary(t),r,n)}},{key:"createTemporaryFileUrl",value:function(e){var t=e.base64Data,r=e.dataType;return f.a.tempUrlForData(f.a.base64toBinary(t),r)}},{key:"revokeTempUrl",value:function(e){f.a.revokeTempUrl(e)}},{key:"createNewCredentials",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.credentialManager.createNewCredentials());case 1:case"end":return e.stop()}},null,this)}},{key:"numberOfFilesEncryptedWithCredential",value:function(e){return this.fileManager.fileDescriptorsEncryptedWithCredential(e).length}},{key:"credentialForFileDescriptor",value:function(e){return this.credentialManager.credentialForFileDescriptor(e)}},{key:"getAllCredentials",value:function(){return this.credentialManager.getAllCredentials()}},{key:"getDefaultCredentials",value:function(){return this.credentialManager.getDefaultCredentials()}},{key:"setCredentialAsDefault",value:function(e){return this.credentialManager.setCredentialAsDefault(e)}},{key:"deleteCredential",value:function(e){return this.credentialManager.deleteCredential(e)}},{key:"saveCredential",value:function(e){return this.credentialManager.saveCredential(e)}},{key:"getAllIntegrations",value:function(){return this.integrationManager.integrations}},{key:"integrationForFileDescriptor",value:function(e){return this.integrationManager.integrationForFileDescriptor(e)}},{key:"saveIntegrationFromCode",value:function(e){return this.integrationManager.saveIntegrationFromCode(e)}},{key:"getDefaultIntegration",value:function(){return this.integrationManager.getDefaultIntegration()}},{key:"setIntegrationAsDefault",value:function(e){return this.integrationManager.setIntegrationAsDefault(e)}},{key:"deleteIntegration",value:function(e){return this.integrationManager.deleteIntegration(e)}},{key:"displayStringForIntegration",value:function(e){return this.integrationManager.displayStringForIntegration(e)}},{key:"base64toBinary",value:function(e){return f.a.base64toBinary(e)}},{key:"isMobile",value:function(){return this.extensionBridge.isMobile()}},{key:"getEnvironment",value:function(){return this.extensionBridge.getEnvironment()}},{key:"getPlatform",value:function(){return this.extensionBridge.getPlatform()}},{key:"copyTextToClipboard",value:function(e){return f.a.copyTextToClipboard(e)}}]),e}())},function(e,t,r){(function(e,n){var i;(function(){function a(e,t){return e.set(t[0],t[1]),e}function o(e,t){return e.add(t),e}function s(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function u(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););}function c(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function l(e,t){return!(null==e||!e.length)&&-1<v(e,t,0)}function f(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function h(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function p(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)r=t(r,e[n],n,e);return r}function d(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function y(e,t,r){var n=e.length;for(r+=-1;++r<n;)if(t(e[r],r,e))return r;return-1}function v(e,t,r){if(t===t)e:{--r;for(var n=e.length;++r<n;)if(e[r]===t){e=r;break e}e=-1}else e=y(e,g,r);return e}function g(e){return e!==e}function m(e){return function(t){return null==t?ht:t[e]}}function k(e,t){return f(t,function(t){return e[t]})}function b(e,t){return e.has(t)}function w(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function x(e){var t=Object;return function(r){return e(t(r))}}function S(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function _(){}function I(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function R(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function D(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function A(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new D;++t<r;)this.add(e[t])}function C(e){this.size=(this.__data__=new R(e)).size}function M(e,t){var r=Hr(e),n=!r&&Lr(e),i=!r&&!n&&Ur(e),a=!r&&!n&&!i&&Nr(e);if(r=r||n||i||a){for(var n=e.length,o=String,s=-1,u=Array(n);++s<n;)u[s]=o(s);n=u}else n=[];var c,o=n.length;for(c in e)!t&&!Kt.call(e,c)||r&&("length"==c||i&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||De(c,o))||n.push(c);return n}function F(e,t,r){(r===ht||He(e[t],r))&&(r!==ht||t in e)||T(e,t,r)}function O(e,t,r){var n=e[t];Kt.call(e,t)&&He(n,r)&&(r!==ht||t in e)||T(e,t,r)}function B(e,t){for(var r=e.length;r--;)if(He(e[r][0],t))return r;return-1}function P(e,t){return e&&ce(t,rt(t),e)}function E(e,t){return e&&ce(t,nt(t),e)}function T(e,t,r){"__proto__"==t&&ir?ir(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function j(e,t,r,n,i,a){var o,s=1&t,c=2&t,l=4&t;if(r&&(o=i?r(e,n,i,a):r(e)),o!==ht)return o;if(!We(e))return e;if(n=Hr(e)){if(o=Se(e),!s)return ue(e,o)}else{var f=Br(e),h="[object Function]"==f||"[object GeneratorFunction]"==f;if(Ur(e))return ae(e,s);if("[object Object]"==f||"[object Arguments]"==f||h&&!i){if(o=c||h?{}:_e(e),!s)return c?fe(e,E(o,e)):le(e,P(o,e))}else{if(!At[f])return i?e:{};o=Ie(e,f,j,s)}}if(a||(a=new C),i=a.get(e))return i;a.set(e,o);var c=l?c?me:ge:c?nt:rt,p=n?ht:c(e);return u(p||e,function(n,i){p&&(i=n,n=e[i]),O(o,i,j(n,t,r,i,e,a))}),o}function L(e,t){var r=[];return Dr(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r}function H(e,t,r,n,i){var a=-1,o=e.length;for(r||(r=Re),i||(i=[]);++a<o;){var s=e[a];0<t&&r(s)?1<t?H(s,t-1,r,n,i):h(i,s):n||(i[i.length]=s)}return i}function U(e,t){t=ie(t,e);for(var r=0,n=t.length;null!=e&&r<n;)e=e[Oe(t[r++])];return r&&r==n?e:ht}function N(e,t,r){return t=t(e),Hr(e)?t:h(t,r(e))}function z(e){if(null==e)e=e===ht?"[object Undefined]":"[object Null]";else if(nr&&nr in Object(e)){var t=Kt.call(e,nr),r=e[nr];try{e[nr]=ht;var n=!0}catch(e){}var i=Jt.call(e);n&&(t?e[nr]=r:delete e[nr]),e=i}else e=Jt.call(e);return e}function K(e){return Je(e)&&"[object Arguments]"==z(e)}function W(e,t,r,n,i){if(e===t)t=!0;else if(null==e||null==t||!Je(e)&&!Je(t))t=e!==e&&t!==t;else e:{var a=Hr(e),o=Hr(t),s=a?"[object Array]":Br(e),u=o?"[object Array]":Br(t),s="[object Arguments]"==s?"[object Object]":s,u="[object Arguments]"==u?"[object Object]":u,c="[object Object]"==s,o="[object Object]"==u;if((u=s==u)&&Ur(e)){if(!Ur(t)){t=!1;break e}a=!0,c=!1}if(u&&!c)i||(i=new C),t=a||Nr(e)?de(e,t,r,n,W,i):ye(e,t,s,r,n,W,i);else{if(!(1&r)&&(a=c&&Kt.call(e,"__wrapped__"),s=o&&Kt.call(t,"__wrapped__"),a||s)){e=a?e.value():e,t=s?t.value():t,i||(i=new C),t=W(e,t,r,n,i);break e}if(u)t:if(i||(i=new C),a=1&r,s=ge(e),o=s.length,u=ge(t).length,o==u||a){for(c=o;c--;){var l=s[c];if(!(a?l in t:Kt.call(t,l))){t=!1;break t}}if((u=i.get(e))&&i.get(t))t=u==t;else{u=!0,i.set(e,t),i.set(t,e);for(var f=a;++c<o;){var l=s[c],h=e[l],p=t[l];if(n)var d=a?n(p,h,l,t,e,i):n(h,p,l,e,t,i);if(d===ht?h!==p&&!W(h,p,r,n,i):!d){u=!1;break}f||(f="constructor"==l)}u&&!f&&(r=e.constructor,n=t.constructor,r!=n&&"constructor"in e&&"constructor"in t&&!("function"==typeof r&&r instanceof r&&"function"==typeof n&&n instanceof n)&&(u=!1)),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function J(e,t){var r=t.length,n=r;if(null==e)return!n;for(e=Object(e);r--;){var i=t[r];if(i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++r<n;){var i=t[r],a=i[0],o=e[a],s=i[1];if(i[2]){if(o===ht&&!(a in e))return!1}else if(i=new C,void 0===ht?!W(s,o,3,void 0,i):1)return!1}return!0}function q(e){return Je(e)&&Ke(e.length)&&!!Dt[z(e)]}function V(e){return"function"==typeof e?e:null==e?ot:"object"==typeof e?Hr(e)?X(e[0],e[1]):G(e):ct(e)}function $(e,t){var r=-1,n=Ue(e)?Array(e.length):[];return Dr(e,function(e,i,a){n[++r]=t(e,i,a)}),n}function G(e){var t=we(e);return 1==t.length&&t[0][2]?Me(t[0][0],t[0][1]):function(r){return r===e||J(r,t)}}function X(e,t){return Ae(e)&&t===t&&!We(t)?Me(Oe(e),t):function(r){var n=et(r,e);return n===ht&&n===t?tt(r,e):W(t,n,3)}}function Y(e,t,r,n,i){e!==t&&Ar(t,function(a,o){if(We(a)){i||(i=new C);var s=i,u=e[o],c=t[o],l=s.get(c);if(l)F(e,o,l);else{var l=n?n(u,c,o+"",e,t,s):ht,f=l===ht;if(f){var h=Hr(c),p=!h&&Ur(c),d=!h&&!p&&Nr(c),l=c;h||p||d?Hr(u)?l=u:Ne(u)?l=ue(u):p?(f=!1,l=ae(c,!0)):d?(f=!1,l=se(c,!0)):l=[]:qe(c)||Lr(c)?(l=u,Lr(u)?l=Qe(u):(!We(u)||r&&ze(u))&&(l=_e(c))):f=!1}f&&(s.set(c,l),Y(l,c,r,n,s),s.delete(c)),F(e,o,l)}}else s=n?n(e[o],a,o+"",e,t,i):ht,s===ht&&(s=a),F(e,o,s)},nt)}function Q(e,t){return Z(e,t,function(t,r){return tt(e,r)})}function Z(e,t,r){for(var n=-1,i=t.length,a={};++n<i;){var o=t[n],s=U(e,o);if(r(s,o)){var u=a,o=ie(o,e);if(We(u))for(var o=ie(o,u),c=-1,l=o.length,f=l-1;null!=u&&++c<l;){var h=Oe(o[c]),p=s;if(c!=f){var d=u[h],p=ht;p===ht&&(p=We(d)?d:De(o[c+1])?[]:{})}O(u,h,p),u=u[h]}}}return a}function ee(e){return function(t){return U(t,e)}}function te(e){return Pr(Fe(e,void 0,ot),e+"")}function re(e){if("string"==typeof e)return e;if(Hr(e))return f(e,re)+"";if($e(e))return Ir?Ir.call(e):"";var t=e+"";return"0"==t&&1/e==-pt?"-0":t}function ne(e,t){t=ie(t,e);var r;if(2>t.length)r=e;else{r=t;var n=0,i=-1,a=-1,o=r.length;for(0>n&&(n=-n>o?0:o+n),i=i>o?o:i,0>i&&(i+=o),o=n>i?0:i-n>>>0,n>>>=0,i=Array(o);++a<o;)i[a]=r[a+n];r=U(e,i)}null==(e=r)||delete e[Oe(Te(t))]}function ie(e,t){return Hr(e)?e:Ae(e,t)?[e]:Er(Ze(e))}function ae(e,t){if(t)return e.slice();var r=e.length,r=Yt?Yt(r):new e.constructor(r);return e.copy(r),r}function oe(e){var t=new e.constructor(e.byteLength);return new Xt(t).set(new Xt(e)),t}function se(e,t){return new e.constructor(t?oe(e.buffer):e.buffer,e.byteOffset,e.length)}function ue(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}function ce(e,t,r){var n=!r;r||(r={});for(var i=-1,a=t.length;++i<a;){var o=t[i],s=ht;s===ht&&(s=e[o]),n?T(r,o,s):O(r,o,s)}return r}function le(e,t){return ce(e,Fr(e),t)}function fe(e,t){return ce(e,Or(e),t)}function he(e){return te(function(t,r){var n,i=-1,a=r.length,o=1<a?r[a-1]:ht,s=2<a?r[2]:ht,o=3<e.length&&"function"==typeof o?(a--,o):ht;if(n=s){n=r[0];var u=r[1];if(We(s)){var c=typeof u;n=!!("number"==c?Ue(s)&&De(u,s.length):"string"==c&&u in s)&&He(s[u],n)}else n=!1}for(n&&(o=3>a?ht:o,a=1),t=Object(t);++i<a;)(s=r[i])&&e(t,s,i,o);return t})}function pe(e){return qe(e)?ht:e}function de(e,t,r,n,i,a){var o=1&r,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;if((u=a.get(e))&&a.get(t))return u==t;var u=-1,c=!0,l=2&r?new A:ht;for(a.set(e,t),a.set(t,e);++u<s;){var f=e[u],h=t[u];if(n)var p=o?n(h,f,u,t,e,a):n(f,h,u,e,t,a);if(p!==ht){if(p)continue;c=!1;break}if(l){if(!d(t,function(e,t){if(!b(l,t)&&(f===e||i(f,e,r,n,a)))return l.push(t)})){c=!1;break}}else if(f!==h&&!i(f,h,r,n,a)){c=!1;break}}return a.delete(e),a.delete(t),c}function ye(e,t,r,n,i,a,o){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!a(new Xt(e),new Xt(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return He(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=w;case"[object Set]":if(s||(s=S),e.size!=t.size&&!(1&n))break;return(r=o.get(e))?r==t:(n|=2,o.set(e,t),t=de(s(e),s(t),n,i,a,o),o.delete(e),t);case"[object Symbol]":if(_r)return _r.call(e)==_r.call(t)}return!1}function ve(e){return Pr(Fe(e,ht,Ee),e+"")}function ge(e){return N(e,rt,Fr)}function me(e){return N(e,nt,Or)}function ke(){var e=_.iteratee||st,e=e===st?V:e;return arguments.length?e(arguments[0],arguments[1]):e}function be(e,t){var r=e.__data__,n=typeof t;return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function we(e){for(var t=rt(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,i===i&&!We(i)]}return t}function xe(e,t){var r=null==e?ht:e[t];return(!We(r)||Wt&&Wt in r?0:(ze(r)?Vt:_t).test(Be(r)))?r:ht}function Se(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&Kt.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function _e(e){return"function"!=typeof e.constructor||Ce(e)?{}:Rr(Qt(e))}function Ie(e,t,r,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return oe(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return t=n?oe(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return se(e,n);case"[object Map]":return t=n?r(w(e),1):w(e),p(t,a,new e.constructor);case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return t=new e.constructor(e.source,wt.exec(e)),t.lastIndex=e.lastIndex,t;case"[object Set]":return t=n?r(S(e),1):S(e),p(t,o,new e.constructor);case"[object Symbol]":return _r?Object(_r.call(e)):{}}}function Re(e){return Hr(e)||Lr(e)||!!(rr&&e&&e[rr])}function De(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||Rt.test(e))&&-1<e&&0==e%1&&e<t}function Ae(e,t){if(Hr(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!$e(e))||vt.test(e)||!yt.test(e)||null!=t&&e in Object(t)}function Ce(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ut)}function Me(e,t){return function(r){return null!=r&&r[e]===t&&(t!==ht||e in Object(r))}}function Fe(e,t,r){return t=cr(t===ht?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=cr(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];for(i=-1,a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),s(e,this,a)}}function Oe(e){if("string"==typeof e||$e(e))return e;var t=e+"";return"0"==t&&1/e==-pt?"-0":t}function Be(e){if(null!=e){try{return zt.call(e)}catch(e){}return e+""}return""}function Pe(e,t,r){var n=null==e?0:e.length;return n?(r=null==r?0:Xe(r),0>r&&(r=cr(n+r,0)),y(e,ke(t,3),r)):-1}function Ee(e){return(null==e?0:e.length)?H(e,1):[]}function Te(e){var t=null==e?0:e.length;return t?e[t-1]:ht}function je(e,t){var r;if(e&&e.length&&t&&t.length){r=t;var n=v,i=-1,a=r.length;for(e===r&&(r=ue(r));++i<a;)for(var o=0,s=r[i];-1<(o=n(e,s,o,void 0));)e!==e&&tr.call(e,o,1),tr.call(e,o,1);r=e}else r=e;return r}function Le(e,t){function r(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;return a.has(i)?a.get(i):(n=e.apply(this,n),r.cache=a.set(i,n)||a,n)}if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");return r.cache=new(Le.Cache||D),r}function He(e,t){return e===t||e!==e&&t!==t}function Ue(e){return null!=e&&Ke(e.length)&&!ze(e)}function Ne(e){return Je(e)&&Ue(e)}function ze(e){return!!We(e)&&("[object Function]"==(e=z(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)}function Ke(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e}function We(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Je(e){return null!=e&&"object"==typeof e}function qe(e){return!(!Je(e)||"[object Object]"!=z(e))&&(null===(e=Qt(e))||"function"==typeof(e=Kt.call(e,"constructor")&&e.constructor)&&e instanceof e&&zt.call(e)==qt)}function Ve(e){return"string"==typeof e||!Hr(e)&&Je(e)&&"[object String]"==z(e)}function $e(e){return"symbol"==typeof e||Je(e)&&"[object Symbol]"==z(e)}function Ge(e){return e?(e=Ye(e),e===pt||e===-pt?1.7976931348623157e308*(0>e?-1:1):e===e?e:0):0===e?e:0}function Xe(e){e=Ge(e);var t=e%1;return e===e?t?e-t:e:0}function Ye(e){if("number"==typeof e)return e;if($e(e))return dt;if(We(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=We(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e.replace(kt,"");var t=St.test(e);return t||It.test(e)?Mt(e.slice(2),t?2:8):xt.test(e)?dt:+e}function Qe(e){return ce(e,nt(e))}function Ze(e){return null==e?"":re(e)}function et(e,t,r){return e=null==e?ht:U(e,t),e===ht?r:e}function tt(e,t){var r;if(r=null!=e){r=e;var n;n=ie(t,r);for(var i=-1,a=n.length,o=!1;++i<a;){var s=Oe(n[i]);if(!(o=null!=r&&null!=r&&s in Object(r)))break;r=r[s]}o||++i!=a?r=o:(a=null==r?0:r.length,r=!!a&&Ke(a)&&De(s,a)&&(Hr(r)||Lr(r)))}return r}function rt(e){if(Ue(e))e=M(e);else if(Ce(e)){var t,r=[];for(t in Object(e))Kt.call(e,t)&&"constructor"!=t&&r.push(t);e=r}else e=ur(e);return e}function nt(e){if(Ue(e))e=M(e,!0);else if(We(e)){var t,r=Ce(e),n=[];for(t in e)("constructor"!=t||!r&&Kt.call(e,t))&&n.push(t);e=n}else{if(t=[],null!=e)for(r in Object(e))t.push(r);e=t}return e}function it(e){return null==e?[]:k(e,rt(e))}function at(e){return function(){return e}}function ot(e){return e}function st(e){return V("function"==typeof e?e:j(e,1))}function ut(){}function ct(e){return Ae(e)?m(Oe(e)):ee(e)}function lt(){return[]}function ft(){return!1}var ht,pt=1/0,dt=NaN,yt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,vt=/^\w*$/,gt=/^\./,mt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kt=/^\s+|\s+$/g,bt=/\\(\\)?/g,wt=/\w*$/,xt=/^[-+]0x[0-9a-f]+$/i,St=/^0b[01]+$/i,_t=/^\[object .+?Constructor\]$/,It=/^0o[0-7]+$/i,Rt=/^(?:0|[1-9]\d*)$/,Dt={};Dt["[object Float32Array]"]=Dt["[object Float64Array]"]=Dt["[object Int8Array]"]=Dt["[object Int16Array]"]=Dt["[object Int32Array]"]=Dt["[object Uint8Array]"]=Dt["[object Uint8ClampedArray]"]=Dt["[object Uint16Array]"]=Dt["[object Uint32Array]"]=!0,Dt["[object Arguments]"]=Dt["[object Array]"]=Dt["[object ArrayBuffer]"]=Dt["[object Boolean]"]=Dt["[object DataView]"]=Dt["[object Date]"]=Dt["[object Error]"]=Dt["[object Function]"]=Dt["[object Map]"]=Dt["[object Number]"]=Dt["[object Object]"]=Dt["[object RegExp]"]=Dt["[object Set]"]=Dt["[object String]"]=Dt["[object WeakMap]"]=!1;var At={};At["[object Arguments]"]=At["[object Array]"]=At["[object ArrayBuffer]"]=At["[object DataView]"]=At["[object Boolean]"]=At["[object Date]"]=At["[object Float32Array]"]=At["[object Float64Array]"]=At["[object Int8Array]"]=At["[object Int16Array]"]=At["[object Int32Array]"]=At["[object Map]"]=At["[object Number]"]=At["[object Object]"]=At["[object RegExp]"]=At["[object Set]"]=At["[object String]"]=At["[object Symbol]"]=At["[object Uint8Array]"]=At["[object Uint8ClampedArray]"]=At["[object Uint16Array]"]=At["[object Uint32Array]"]=!0,At["[object Error]"]=At["[object Function]"]=At["[object WeakMap]"]=!1;var Ct,Mt=parseInt,Ft="object"==typeof e&&e&&e.Object===Object&&e,Ot="object"==typeof self&&self&&self.Object===Object&&self,Bt=Ft||Ot||Function("return this")(),Pt="object"==typeof t&&t&&!t.nodeType&&t,Et=Pt&&"object"==typeof n&&n&&!n.nodeType&&n,Tt=Et&&Et.exports===Pt,jt=Tt&&Ft.process;e:{try{Ct=jt&&jt.binding&&jt.binding("util");break e}catch(a){}Ct=void 0}var Lt=Ct&&Ct.isTypedArray,Ht=Array.prototype,Ut=Object.prototype,Nt=Bt["__core-js_shared__"],zt=Function.prototype.toString,Kt=Ut.hasOwnProperty,Wt=function(){var e=/[^.]+$/.exec(Nt&&Nt.keys&&Nt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Jt=Ut.toString,qt=zt.call(Object),Vt=RegExp("^"+zt.call(Kt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$t=Tt?Bt.Buffer:ht,Gt=Bt.Symbol,Xt=Bt.Uint8Array,Yt=$t?$t.a:ht,Qt=x(Object.getPrototypeOf),Zt=Object.create,er=Ut.propertyIsEnumerable,tr=Ht.splice,rr=Gt?Gt.isConcatSpreadable:ht,nr=Gt?Gt.toStringTag:ht,ir=function(){try{var e=xe(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ar=Math.floor,or=Object.getOwnPropertySymbols,sr=$t?$t.isBuffer:ht,ur=x(Object.keys),cr=Math.max,lr=Math.min,fr=Date.now,hr=xe(Bt,"DataView"),pr=xe(Bt,"Map"),dr=xe(Bt,"Promise"),yr=xe(Bt,"Set"),vr=xe(Bt,"WeakMap"),gr=xe(Object,"create"),mr=Be(hr),kr=Be(pr),br=Be(dr),wr=Be(yr),xr=Be(vr),Sr=Gt?Gt.prototype:ht,_r=Sr?Sr.valueOf:ht,Ir=Sr?Sr.toString:ht,Rr=function(){function e(){}return function(t){return We(t)?Zt?Zt(t):(e.prototype=t,t=new e,e.prototype=ht,t):{}}}();I.prototype.clear=function(){this.__data__=gr?gr(null):{},this.size=0},I.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},I.prototype.get=function(e){var t=this.__data__;return gr?(e=t[e],"__lodash_hash_undefined__"===e?ht:e):Kt.call(t,e)?t[e]:ht},I.prototype.has=function(e){var t=this.__data__;return gr?t[e]!==ht:Kt.call(t,e)},I.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=gr&&t===ht?"__lodash_hash_undefined__":t,this},R.prototype.clear=function(){this.__data__=[],this.size=0},R.prototype.delete=function(e){var t=this.__data__;return!(0>(e=B(t,e))||(e==t.length-1?t.pop():tr.call(t,e,1),--this.size,0))},R.prototype.get=function(e){var t=this.__data__;return e=B(t,e),0>e?ht:t[e][1]},R.prototype.has=function(e){return-1<B(this.__data__,e)},R.prototype.set=function(e,t){var r=this.__data__,n=B(r,e);return 0>n?(++this.size,r.push([e,t])):r[n][1]=t,this},D.prototype.clear=function(){this.size=0,this.__data__={hash:new I,map:new(pr||R),string:new I}},D.prototype.delete=function(e){return e=be(this,e).delete(e),this.size-=e?1:0,e},D.prototype.get=function(e){return be(this,e).get(e)},D.prototype.has=function(e){return be(this,e).has(e)},D.prototype.set=function(e,t){var r=be(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},A.prototype.add=A.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},A.prototype.has=function(e){return this.__data__.has(e)},C.prototype.clear=function(){this.__data__=new R,this.size=0},C.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},C.prototype.get=function(e){return this.__data__.get(e)},C.prototype.has=function(e){return this.__data__.has(e)},C.prototype.set=function(e,t){var r=this.__data__;if(r instanceof R){var n=r.__data__;if(!pr||199>n.length)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new D(n)}return r.set(e,t),this.size=r.size,this};var Dr=function(e,t){return function(t,r){if(null==t)return t;if(!Ue(t))return e(t,r);for(var n=t.length,i=-1,a=Object(t);++i<n&&!1!==r(a[i],i,a););return t}}(function(e,t){return e&&Ar(e,t,rt)}),Ar=function(e){return function(e,t,r){var n=-1,i=Object(e);r=r(e);for(var a=r.length;a--;){var o=r[++n];if(!1===t(i[o],o,i))break}return e}}(),Cr=ir?function(e,t){return ir(e,"toString",{configurable:!0,enumerable:!1,value:at(t),writable:!0})}:ot,Mr=yr&&1/S(new yr([,-0]))[1]==pt?function(e){return new yr(e)}:ut,Fr=or?function(e){return null==e?[]:(e=Object(e),c(or(e),function(t){return er.call(e,t)}))}:lt,Or=or?function(e){for(var t=[];e;)h(t,Fr(e)),e=Qt(e);return t}:lt,Br=z;(hr&&"[object DataView]"!=Br(new hr(new ArrayBuffer(1)))||pr&&"[object Map]"!=Br(new pr)||dr&&"[object Promise]"!=Br(dr.resolve())||yr&&"[object Set]"!=Br(new yr)||vr&&"[object WeakMap]"!=Br(new vr))&&(Br=function(e){var t=z(e);if(e=(e="[object Object]"==t?e.constructor:ht)?Be(e):"")switch(e){case mr:return"[object DataView]";case kr:return"[object Map]";case br:return"[object Promise]";case wr:return"[object Set]";case xr:return"[object WeakMap]"}return t});var Pr=function(e){var t=0,r=0;return function(){var n=fr(),i=16-(n-r);if(r=n,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(ht,arguments)}}(Cr),Er=function(e){e=Le(e,function(e){return 500===t.size&&t.clear(),e});var t=e.cache;return e}(function(e){var t=[];return gt.test(e)&&t.push(""),e.replace(mt,function(e,r,n,i){t.push(n?i.replace(bt,"$1"):r||e)}),t}),Tr=te(je),jr=function(e){return function(t,r,n){var i=Object(t);if(!Ue(t)){var a=ke(r,3);t=rt(t),r=function(e){return a(i[e],e,i)}}return r=e(t,r,n),-1<r?i[a?t[r]:r]:ht}}(Pe);Le.Cache=D;var Lr=K(function(){return arguments}())?K:function(e){return Je(e)&&Kt.call(e,"callee")&&!er.call(e,"callee")},Hr=Array.isArray,Ur=sr||ft,Nr=Lt?function(e){return function(t){return e(t)}}(Lt):q,zr=he(function(e,t,r){Y(e,t,r)}),Kr=he(function(e,t,r,n){Y(e,t,r,n)}),Wr=ve(function(e,t){var r={};if(null==e)return r;var n=!1;t=f(t,function(t){return t=ie(t,e),n||(n=1<t.length),t}),ce(e,me(e),r),n&&(r=j(r,7,pe));for(var i=t.length;i--;)ne(r,t[i]);return r}),Jr=ve(function(e,t){return null==e?{}:Q(e,t)});_.constant=at,_.filter=function(e,t){return(Hr(e)?c:L)(e,ke(t,3))},_.flatten=Ee,_.iteratee=st,_.keys=rt,_.keysIn=nt,_.map=function(e,t){return(Hr(e)?f:$)(e,ke(t,3))},_.memoize=Le,_.merge=zr,_.mergeWith=Kr,_.omit=Wr,_.pick=Jr,_.property=ct,_.pull=Tr,_.pullAll=je,_.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],a=e.length;for(t=ke(t,3);++n<a;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}for(n=e?i.length:0,a=n-1;n--;)if(o=i[n],n==a||o!==s){var s=o;De(o)?tr.call(e,o,1):ne(e,o)}return r},_.toPlainObject=Qe,_.uniq=function(e){if(e&&e.length)e:{var t=-1,r=l,n=e.length,i=!0,a=[],o=a;if(200<=n){if(r=Mr(e)){e=S(r);break e}i=!1,r=b,o=new A}else o=a;t:for(;++t<n;){var s=e[t],u=s,s=0!==s?s:0;if(i&&u===u){for(var c=o.length;c--;)if(o[c]===u)continue t;a.push(s)}else r(o,u,void 0)||(o!==a&&o.push(u),a.push(s))}e=a}else e=[];return e},_.values=it,_.cloneDeep=function(e){return j(e,5)},_.eq=He,_.find=jr,_.findIndex=Pe,_.get=et,_.hasIn=tt,_.identity=ot,_.includes=function(e,t,r,n){return e=Ue(e)?e:it(e),r=r&&!n?Xe(r):0,n=e.length,0>r&&(r=cr(n+r,0)),Ve(e)?r<=n&&-1<e.indexOf(t,r):!!n&&-1<v(e,t,r)},_.isArguments=Lr,_.isArray=Hr,_.isArrayLike=Ue,_.isArrayLikeObject=Ne,_.isBuffer=Ur,_.isFunction=ze,_.isLength=Ke,_.isObject=We,_.isObjectLike=Je,_.isPlainObject=qe,_.isString=Ve,_.isSymbol=$e,_.isTypedArray=Nr,_.last=Te,_.stubArray=lt,_.stubFalse=ft,_.noop=ut,_.sortedIndexBy=function(e,t,r){r=ke(r,2),t=r(t);for(var n=0,i=null==e?0:e.length,a=t!==t,o=null===t,s=$e(t),u=t===ht;n<i;){var c=ar((n+i)/2),l=r(e[c]),f=l!==ht,h=null===l,p=l===l,d=$e(l);(a?p:u?p&&f:o?p&&f&&!h:s?p&&f&&!h&&!d:h||d?0:l<t)?n=c+1:i=c}return lr(i,4294967294)},_.toFinite=Ge,_.toInteger=Xe,_.toNumber=Ye,_.toString=Ze,_.VERSION="4.17.4",Bt._=_,void 0!==(i=function(){return _}.call(t,r,t,n))&&(n.exports=i)}).call(this)}).call(t,r(3),r(6)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}r.d(t,"a",function(){return u});var o=r(1),s=(r.n(o),r(0)),u=(r.n(s),function(){function e(){n(this,e),this.httpManger=new s.SFHttpManager,this.httpManger.setJWTRequestHandler(function(){})}return a(e,[{key:"setCredentials",value:function(e){this.credentials=e}},{key:"uploadFile",value:function(e,t,r){var n,i,a=this;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return n="".concat(r.content.relayUrl,"/integrations/save-item"),i={file:{name:e,item:t},source:r.content.source,authorization:r.content.authorization},o.abrupt("return",new Promise(function(e,t){a.httpManger.postAbsolute(n,i,function(t){e(t.metadata)},function(e){var r=e.error;r||(r={message:"File upload failed."}),console.log("Upload error response",r),t(r)})}));case 3:case"end":return o.stop()}})}},{key:"downloadFile",value:function(e,t){var r,n,i=this;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return r="".concat(t.content.relayUrl,"/integrations/download-item"),n={metadata:e.content.serverMetadata,authorization:t.content.authorization},a.abrupt("return",new Promise(function(e,t){i.httpManger.postAbsolute(r,n,function(t){e(t)},function(e){var r=e.error;console.log("Download error response",e),t(r)})}));case 3:case"end":return a.stop()}})}},{key:"deleteFile",value:function(e,t){var r,n,i=this;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return r="".concat(t.content.relayUrl,"/integrations/delete-item"),n={metadata:e.content.serverMetadata,authorization:t.content.authorization},a.abrupt("return",new Promise(function(e,t){i.httpManger.postAbsolute(r,n,function(t){e(t)},function(e){var r=e.error;console.log("Download error response",e),t(r)})}));case 3:case"end":return a.stop()}})}}]),e}())},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}r.d(t,"a",function(){return c});var o=r(1),s=(r.n(o),r(0)),u=(r.n(s),r(2)),c=function(){function e(t){n(this,e),this.extensionBridge=t}return a(e,[{key:"integrationForFileDescriptor",value:function(e){return this.integrations.find(function(t){return e.content.serverMetadata&&t.content.source==e.content.serverMetadata.source})}},{key:"parseIntegrationCode",value:function(e){var t=atob(e),r=JSON.parse(t);return r.rawCode=e,r}},{key:"saveIntegrationFromCode",value:function(e){var t,r;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return t=this.parseIntegrationCode(e),0==this.integrations.length&&(t.isDefaultUploadSource=!0),r=this.createAndSaveIntegrationObject(t),n.abrupt("return",r);case 4:case"end":return n.stop()}},null,this)}},{key:"createAndSaveIntegrationObject",value:function(e){var t=new s.SFItem({content_type:u.a.FileSafeIntegrationContentTypeKey,content:e});return this.extensionBridge.createItems([t]),t}},{key:"getDefaultIntegration",value:function(){return this.integrations.find(function(e){return e.content.isDefaultUploadSource})}},{key:"setIntegrationAsDefault",value:function(e){var t=[e],r=this.getDefaultIntegration();r&&(r.content.isDefaultUploadSource=!1,t.push(r)),e.content.isDefaultUploadSource=!0,this.extensionBridge.saveItems(t)}},{key:"displayStringForIntegration",value:function(e){var t=e.content.source.split("_"),r="",n=0,i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;r+=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(c),n<t.length-1&&(r+=" "),n++}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return r}},{key:"deleteIntegration",value:function(e){var t=this,r=e.content.isDefaultUploadSource;this.extensionBridge.deleteItem(e,function(n){if(n.deleted&&r&&t.integrations.length>0){var i=!0,a=!1,o=void 0;try{for(var s,u=t.integrations[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;if(c!=e){t.setIntegrationAsDefault(c);break}}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}})}},{key:"integrations",get:function(){return this.extensionBridge.filterItems(u.a.FileSafeIntegrationContentTypeKey)}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",function(){return l});var s=r(1),u=(r.n(s),r(0)),c=(r.n(u),r(2)),l=function(){function e(t){var r=this,i=t.extensionBridge,a=t.onCredentialLoad;n(this,e),o(this,"getDefaultCredentials",function(){var e=r.credentials.find(function(e){return e.content.isDefault});return!e&&r.credentials.length>0&&(e=r.credentials[0]),e}),o(this,"setCredentialAsDefault",function(e){var t=r.getDefaultCredentials();t&&(t.content.isDefault=!1),e.content.isDefault=!0,r.extensionBridge.saveItems([t,e])}),o(this,"deleteCredential",function(e){r.extensionBridge.deleteItem(e)}),this.extensionBridge=i,this.onCredentialLoad=a,this.credentials=[],this.extensionBridge.addEventHandler(function(e){e==c.a.BridgeEventReceivedItems&&r.reloadCredentials()})}return a(e,[{key:"reloadCredentials",value:function(){this.credentials=[];var e=this.extensionBridge.filterItems(c.a.FileSafeCredentialsContentType);if(0!=e.length){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.credentials.find(function(e){return e.uuid==o.uuid})||this.credentials.push(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}this.onCredentialLoad(),this.credentials.length>0&&this.didLoadCredentials()}}},{key:"createNewCredentials",value:function(){var e,t,r,n,i;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return e=256,a.next=3,regeneratorRuntime.awrap(SFJS.crypto.generateRandomKey(e));case 3:return t=a.sent,a.next=6,regeneratorRuntime.awrap(SFJS.crypto.generateRandomKey(e));case 6:return r=a.sent,a.next=9,regeneratorRuntime.awrap(SFJS.crypto.generateInitialKeysAndAuthParamsForUser(t,r));case 9:return n=a.sent,n.isDefault=0==this.credentials.length,i=new u.SFItem({content_type:c.a.FileSafeCredentialsContentType,content:n}),this.extensionBridge.saveItem(i),this.didLoadCredentials(),a.abrupt("return",i);case 15:case"end":return a.stop()}},null,this)}},{key:"didLoadCredentials",value:function(){this.extensionBridge.notifyObserversOfEvent(c.a.BridgeEventLoadedCredentials)}},{key:"credentialForFileDescriptor",value:function(e){return this.credentials.find(function(t){return e.content.references.find(function(e){return e.uuid==t.uuid})})}},{key:"getAllCredentials",value:function(){return this.credentials}},{key:"saveCredential",value:function(e){this.extensionBridge.saveItem(e)}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",function(){return h});var s=r(1),u=(r.n(s),r(0)),c=(r.n(u),r(11)),l=r.n(c),f=r(2),h=function(){function e(t,r,i,a){n(this,e),this.extensionBridge=t,this.relayManager=r,this.integrationManager=i,this.credentialManager=a}return a(e,[{key:"getAllFileDescriptors",value:function(){return this.extensionBridge.getFileDescriptors()}},{key:"fileDescriptorsForNote",value:function(e){return e?this.extensionBridge.getFileDescriptors().filter(function(t){return t.hasRelationshipWithItem(e)}):[]}},{key:"findFileDescriptor",value:function(e){return this.extensionBridge.getFileDescriptors().find(function(t){return t.uuid==e})}},{key:"fileDescriptorsEncryptedWithCredential",value:function(e){return this.extensionBridge.getFileDescriptors().filter(function(t){return t.content.references.find(function(t){return t.uuid==e.uuid})})}},{key:"deleteFileFromDescriptor",value:function(e){var t=this;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(r,n){t.extensionBridge.deleteItems([e],function(n){if(n.deleted){var i=t.integrationManager.integrationForFileDescriptor(e);i&&t.relayManager.deleteFile(e,i).then(function(e){r()})}else r(n)})}));case 1:case"end":return r.stop()}})}},{key:"uploadFile",value:function(e){var t,r,n,i,a,o,s,c,h=this;return regeneratorRuntime.async(function(p){for(;;)switch(p.prev=p.next){case 0:return t=e.fileItem,r=e.inputFileName,n=e.fileType,i=e.credential,a=e.note,o=this.integrationManager.getDefaultIntegration(),s=r.split(".")[1],c="".concat(t.uuid,".sf.json"),p.abrupt("return",new Promise(function(e,s){var p=new l.a;p.addEventListener("message",function(t){var o=t.data;if(o.error)return console.log("Error uploading file",o.error),void s(o.error);var c=new u.SFItem({content_type:f.a.FileDescriptorContentTypeKey,content:{serverMetadata:t.data.metadata,fileName:r,fileType:n}});a&&c.addItemAsRelationship(a),c.addItemAsRelationship(i),h.extensionBridge.createItem(c,function(t){e(t[0])})});var d={outputFileName:c,fileItem:t,integration:o,operation:"upload",credentials:h.credentialManager.getDefaultCredentials()};p.postMessage(d)}));case 5:case"end":return p.stop()}},null,this)}},{key:"downloadFileFromDescriptor",value:function(e){var t,r,n;return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:for(t=3,r=this.integrationManager.integrationForFileDescriptor(e);t-- >0&&!r;)setTimeout(function(){r=this.integrationManager.integrationForFileDescriptor(e)},1e3);if(r){i.next=8;break}throw n=e.content.serverMetadata,n?alert("Unable to find integration named '".concat(n.source,"'.")):alert("Unable to find integration for this file."),"Unable to find integration";case 8:return i.abrupt("return",this.relayManager.downloadFile(e,r).then(function(e){return e.items[0]}));case 9:case"end":return i.stop()}},null,this)}},{key:"encryptFile",value:function(e){var t,r,n,i;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.data,r=e.inputFileName,n=e.fileType,i=e.credential,a.abrupt("return",new Promise(function(e,a){var o=new l.a;o.addEventListener("message",function(t){e(t.data.fileItem)}),o.postMessage({operation:"encrypt",keys:i.content.keys,authParams:i.content.authParams,contentType:f.a.FileItemContentTypeKey,fileData:t,fileName:r,fileType:n})}));case 2:case"end":return a.stop()}})}},{key:"decryptFile",value:function(e){var t,r,n;return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.fileDescriptor,r=e.fileItem,n=e.credential,n||(n=this.credentialManager.credentialForFileDescriptor(t)),i.abrupt("return",new Promise(function(e,t){var i=new l.a;i.addEventListener("message",function(r){var n=r.data;if(n.error)return void t(n.error);e(n)}),i.postMessage({operation:"decrypt",keys:n.content.keys,item:r})}));case 3:case"end":return i.stop()}},null,this)}}]),e}();o(h,"FileItemContentTypeKey","SN|FileSafe|File"),o(h,"FileDescriptorContentTypeKey","SN|FileSafe|FileMetadata")},function(e,t,r){e.exports=function(){return new Worker(r.p+"filesafe-js/EncryptionWorker.js")}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}r.d(t,"a",function(){return o});var o=function(){function e(){n(this,e)}return a(e,null,[{key:"base64toBinary",value:function(e){for(var t=atob(e),r=[],n=0;n<t.length;n++)r.push(t.charCodeAt(n));return new Uint8Array(r)}},{key:"downloadData",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=document.createElement("a");a.setAttribute("download",t);var o=this.tempUrlForData(e,r);a.href=o,a.setAttribute("target","_blank"),i?window.location.href=a.href:(document.body.appendChild(a),a.click(),a.remove()),setTimeout(function(){n.revokeTempUrl(o)},500)}},{key:"tempUrlForData",value:function(e,t){return window.URL.createObjectURL(new Blob([e],{type:t||"text/json"}))}},{key:"revokeTempUrl",value:function(e){window.URL.revokeObjectURL(e)}},{key:"copyTextToClipboard",value:function(e){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t;try{t=document.createElement("textarea"),t.setAttribute("readonly",!0),t.setAttribute("contenteditable",!0),t.style.position="fixed",t.value=e,document.body.appendChild(t),t.focus(),t.select();var r=document.createRange();r.selectNodeContents(t);var n=window.getSelection();n.removeAllRanges(),n.addRange(r),t.setSelectionRange(0,t.value.length),document.execCommand("copy")}catch(e){console.error(e),null}finally{document.body.removeChild(t)}}}}]),e}()}]);